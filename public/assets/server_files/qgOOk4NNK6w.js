if (self.CavalryLogger) { CavalryLogger.start_js(["uJns0"]); }

__d("ChatNotificationConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};},null);
__d("MercuryActionStatus",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null);
__d("MercuryActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",ADD_GROUP_ADMINS:"ma-type:add_group_admins",REMOVE_GROUP_ADMINS:"ma-type:remove_group_admins",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",UNPIN_THREAD:"ma-type:unpin-thread",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",UPDATE_BLOCKER_STATUS:"ma-type:update-blocker-status",UPDATE_BLOCKEE_STATUS:"ma-type:update-blockee-status",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message",JOINABLE_MODE:"ma-type:joinable-mode",APPROVAL_MODE:"ma-type:approval-mode",APPROVAL_QUEUE:"ma-type:approval-queue"};},null);
__d("MercuryAPIArgsSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};},null);
__d("MercuryAttachmentContentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null);
__d("MercuryAttachmentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image",EMOJI_LIKE:"emoji_like",GIFT:"gift",THIRDPARTYSTICKER:"third_party_sticker"};},null);
__d("MercuryAudioType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null);
__d("MercuryErrorType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null);
__d("MercuryGlobalActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null);
__d("MercuryLogMessageType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};},null);
__d("MercuryPayloadSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CHANGE_CUSTOM_LIKE:"client_change_custom_like",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_UPDATE_SNIPPET:"client_update_snippet",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",CLIENT_CREATE_PAGE_ADMIN_NOTE:"client_create_page_admin_note",CLIENT_UNWRAP_MESSAGE:"client_unwrap_message",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag",SERVER_INVALIDATE_THREAD_STATE:"server_invalidate_thread_state",SERVER_INVALIDATE_GLOBAL_STATE:"server_invalidate_global_state"};},null);
__d("MercurySourceType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",FUNDRAISER_MESSAGE_BLAST:"source:fundraiser_message_blast",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",INVITE:"source:invite",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad",MARKETPLACE:"source:marketplace",MESSENGER_LEAD_GEN:"source:messenger:lead_gen",PAGES_MESSAGE_SHORTLINK:"source:pages:message_shortlink",STICKER_SUBSCRIBE:"source:messenger:sticker_subscribe",PHOTO_TAG:"source:messenger:photo_tag",INTERNAL_TEST_PENDING:"source:internal:test_pending",JOB_SEARCH_APPLICATION:"source:job_search:application",MESSENGER_JOINABLE_LINK:"source:messenger:joinable_link",MESSENGER_SMS_BRIDGE_CONVERT:"source:messenger:sms_bridge_conversion"};},null);
__d("MessagingGenericAdminTextType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MADE_POLL_VOTE:"made_poll_vote",CONFIRM_FRIEND_REQUEST:"confirm_friend_request",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",DESTINATION_ETA_MESSAGE:"destination_eta_message",RIDE_ARRIVED_MESSAGE:"ride_arrived_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:"lightweight_event_notify_before_event",LIGHTWEIGHT_EVENT_RSVP:"lightweight_event_rsvp",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",LIGHTWEIGHT_EVENT_UPDATE_LOCATION:"lightweight_event_update_location",LIGHTWEIGHT_EVENT_UPDATE_TIME:"lightweight_event_update_time",LIGHTWEIGHT_EVENT_UPDATE_TITLE:"lightweight_event_update_title",AD_MANAGE_MESSAGE:"ad_manage_message",AD_REPLY_MESSAGE:"ad_reply_message",TAGGED_PHOTO:"tagged_photo",GAME_SCORE:"game_score",INSTANT_GAME_UPDATE:"instant_game_update",M_AI_SURVEY:"m_ai_survey",PHONE_NUMBER_LOOKUP_NOTICE:"phone_number_lookup_notice",ADD_CONTACT:"add_contact",PRODUCT_INVOICE_RECEIPT_REJECTED:"product_invoice_receipt_rejected",PRODUCT_INVOICE_PAID:"product_invoice_paid",PRODUCT_INVOICE_VOIDED:"product_invoice_voided",PRODUCT_INVOICE_SHIPPED:"product_invoice_shipped",PRODUCT_INVOICE_PAYMENT_EXPIRED:"product_invoice_payment_expired",PRODUCT_INVOICE_RECEIPT_UPLOADED:"product_invoice_receipt_uploaded",CHANGE_JOINABLE_SETTING:"change_joinable_setting",CHANGE_THREAD_ADMINS:"change_thread_admins",CHANGE_THREAD_APPROVAL_MODE:"change_thread_approval_mode",CAPY_SESSION_BEGIN:"capy_session_begin",CAPY_SESSION_END:"capy_session_end",CAPY_AGENT_JOIN:"capy_agent_join",GROUP_SMS_PARTICIPANT_JOINED:"group_sms_participant_joined",GROUP_SMS_PARTICIPANT_CAPPED:"group_sms_participant_capped",SMS_PHONE_NUMBER_CHECK:"sms_phone_number_check",MESSENGER_BOT_REVIEW_SENT:"messenger_bot_review_sent",MN_ACCOUNT_LINKING_TEXT:"mn_account_linking_text",MN_ACCOUNT_UNLINKING_TEXT:"mn_account_unlinking_text",MN_ACCOUNT_FORCED_UNLINKING_TEXT:"mn_account_forced_unlinking_text",ADS_WELCOME_MSG:"ads_welcome_msg",THREAD_JOINABLE_PROMOTION_TEXT:"thread_joinable_promotion_text",PAGES_PLATFORM_REQUEST_TEXT:"pages_platform_request_text",MESSENGER_NEW_USER_GET_STARTED:"messenger_new_user_get_started",SMS_PHONE_NUMBER_TOGGLE:"sms_phone_number_toggle",PAGES_PLATFORM_CREATE_APPOINTMENT:"Pages_Platform_create_appointment",JOINABLE_GROUP_THREAD_CREATED:"joinable_group_thread_created",PAGES_PLATFORM_ACCEPT_APPOINTMENT:"pages_platform_accept_appointment",PAGES_PLATFORM_DECLINE_APPOINTMENT:"pages_platform_decline_appointment",PAGES_PLATFORM_USER_CANCEL:"pages_platform_user_cancel",PAGES_PLATFORM_ADMIN_CANCEL:"pages_platform_admin_cancel"};},null);
__d("MessagingTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",MONTAGE:"montage",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email",MARKETPLACE:"marketplace"};},null);
__d("PageMessageEnumTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FLAG:"flag",IMPORTANT:"important",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};},null);
__d('ChatTabActions',['ChatDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,LOWER_ALL_TABS:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),i={Types:h,closeTab:function(j,k){c('ChatDispatcher').dispatch({actionType:h.CLOSE_TAB,reason:k,threadID:j});},closeAllTabs:function(){c('ChatDispatcher').dispatch({actionType:h.CLOSE_ALL_TABS});},closeFragileTabs:function(){c('ChatDispatcher').dispatch({actionType:h.CLOSE_FRAGILE_TABS});},lowerTab:function(j){c('ChatDispatcher').dispatch({actionType:h.LOWER_TAB,threadID:j});},lowerAllTabs:function(){c('ChatDispatcher').dispatch({actionType:h.LOWER_ALL_TABS});},openFragileTab:function(j){c('ChatDispatcher').dispatch({actionType:h.OPEN_FRAGILE_TAB,threadID:j});},openTab:function(j){c('ChatDispatcher').dispatch({actionType:h.OPEN_TAB,threadID:j});},persistLocalState:function(){c('ChatDispatcher').dispatch({actionType:h.PERSIST_LOCAL_STATE});},promoteTab:function(j){c('ChatDispatcher').dispatch({actionType:h.PROMOTE_TAB,threadID:j});},raiseTab:function(j,k,l){c('ChatDispatcher').dispatch({actionType:h.RAISE_TAB,signatureID:l,threadID:j,userAction:k});}};f.exports=i;},null);
__d('WebMessengerEvents',['Arbiter'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=Object.assign(new (c('Arbiter'))(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',STICKER_CLICKED:'sticker-clicked',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(h.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(h.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(h.FOCUS_COMPOSER);},focusSearch:function(){this.inform(h.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(h.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(i){this.inform(h.UPDATE_SELECTION,i);},stickerClicked:function(i,j){this.inform(h.STICKER_CLICKED,{packID:i,stickerID:j});},submitReply:function(){this.inform(h.SUBMIT_REPLY);}});f.exports=h;},null);
__d('WebMessengerSubscriptionsHandler',['SubscriptionsHandler'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new (c('SubscriptionsHandler'))('webmessenger');f.exports=h;},null);
__d("isWebMessengerURI",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){return (/^(\/messages)/.test(i.getPath()));}f.exports=h;},null);
__d('WebMessengerWidthControl',['csx','Arbiter','BlueBar','CSS','CSSClassTransition','Event','Style','URI','ViewportBounds','WebMessengerEvents','WebMessengerSubscriptionsHandler','$','getViewportDimensions','isWebMessengerURI','requestAnimationFrame','shield','throttle'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=205,j=981,k=257,l=18,m=848,n=724,o=.57,p=56,q,r,s;function t(y,z,aa){this.masterChanged=y;this.detailChaned=z;c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(window,'resize',c('throttle')(c('shield')(u,this,this),100)),c('Arbiter').subscribe(['sidebar/initialized','sidebar/visibility','minisidebar/show'],c('shield')(u,this,this),c('Arbiter').SUBSCRIBE_NEW));var ba=x()?p:0;if(aa)ba=i;this._width=x()?0:m;s=true;u(this,ba);}function u(y,z){var aa=c('ViewportBounds').getRight()+c('ViewportBounds').getLeft();aa=aa||z||0;var ba=c('getViewportDimensions').withoutScrollbars().width-aa,ca=Math.round(Math.max(0,ba/2-j/2));ba=j+ca-k;ba-=l;ba=Math.max(n,Math.min(m,ba));if(!isNaN(ba)&&y._width!==ba){y._width=ba;var da=Math.round(ba/(1+o)),ea=ba-da;y.masterChanged(ea);y.detailChaned(da);if(x()){var fa=ba+k;v(function(){if(r){document.body.className=r;r='';}w(fa+'px');s&&c('WebMessengerEvents').detailDOMChanged();s=false;},r);}}}function v(y,z){c('requestAnimationFrame')(y);}function w(y){c('Style').set(c('BlueBar').getNavRoot(),'width',y);c('Style').set(c('$')('globalContainer'),'width',y);}function x(){if(!q)q=c('CSS').matchesSelector(document.body,"._6nw");return q;}c('CSSClassTransition').registerHandler(function(y,z,aa,ba){function ca(da){return x()&&c('isWebMessengerURI')(new (c('URI'))(da));}if(ca(ba)){r=z;return true;}else if(ca(aa)){v(function(){y.className=z;w('');},true);return true;}});f.exports=t;},null);
__d('Dock',['csx','Event','shield','WebMessengerWidthControl','Arbiter','ArbiterMixin','BlueBar','ChatQuietLinks','CSS','DataStore','DOM','Parent','Scroll','Style','Toggler','Vector','emptyFunction'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();c('WebMessengerWidthControl');function i(){}Object.assign(i,c('ArbiterMixin'),{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(j){this.init=c('emptyFunction');this.rootEl=j;this.calculateViewportDimensions();c('ChatQuietLinks').removeEmptyHrefs(this.rootEl);c('Event').listen(j,'click',this._onClick.bind(this));c('Event').listen(window,'resize',this._onWindowResize.bind(this));c('Toggler').subscribe(['show','hide'],function(k,l){var m=l.getActive();if(!c('DOM').contains(j,m))return;if(c('CSS').hasClass(m,'fbNub')){this.notifyNub(m,k);if(k==='show')this._resizeNubFlyout(m);}else{var n=c('Parent').byClass(m,'fbNubFlyout');if(n)c('CSS').conditionClass(n,'menuOpened',k==='show');}}.bind(this));this.inform('init',{},c('Arbiter').BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return this.viewportDimensions=c('Vector').getViewportDimensions();},getFlyoutHeightOffset:function(){if(this.flyoutHeightOffset)return this.flyoutHeightOffset;this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+c('Vector').getElementDimensions(this.rootEl).y;var j=c('BlueBar').getBar();if(j){var k=c('Style').isFixed(j)?'viewport':'document';this.flyoutHeightOffset+=c('Vector').getElementPosition(j,k).y+c('Vector').getElementDimensions(j).y;}return this.flyoutHeightOffset;},toggle:function(j){var k=this._findFlyout(j);if(!k)return;this.subscribe('init',function(){c('Toggler').toggle(j);});},show:function(j){this.subscribe('init',function(){c('Toggler').show(j);});},showNub:function(j){c('CSS').show(j);},hide:function(j){this.subscribe('init',function(){var k=c('Toggler').getInstance(j);c('DOM').contains(j,k.getActive())&&k.hide();});},hideNub:function(j){c('CSS').hide(j);this.hide(j);},setUseMaxHeight:function(j,k){c('CSS').conditionClass(j,'maxHeight',k!==false);this._resizeNubFlyout(j);},_resizeNubFlyout:function(j){var k=this._findFlyout(j);if(!k||c('CSS').hasClass(j,'placeholder')||!(c('CSS').hasClass(j,'openToggler')||c('CSS').hasClass(j,'opened')))return;var l=c('DOM').find(k,'div.fbNubFlyoutOuter'),m=c('DOM').find(l,'div.fbNubFlyoutInner'),n=c('DOM').find(m,'div.fbNubFlyoutBody'),o=c('Scroll').getTop(n),p=n.offsetHeight;c('Style').set(n,'height','auto');var q=c('Vector').getElementDimensions(k),r=c('Vector').getElementDimensions(n),s=this.getMaxFlyoutHeight(j);c('Style').set(k,'max-height',s+'px');c('Style').set(l,'max-height',s+'px');q=c('Vector').getElementDimensions(k);var t=c('Vector').getElementDimensions(m),u=t.y-r.y,v=q.y-u,w=parseInt(n.style.height||n.clientHeight,10),x=v!==w;if(q.y>u&&x)c('Style').set(n,'height',v+'px');c('CSS').removeClass(k,'swapDirection');var y=c('Vector').getElementPosition(k).x;c('CSS').conditionClass(k,'swapDirection',function(){if(y<0)return true;return y+q.x>this.viewportDimensions.x;}.bind(this)());if(x&&o+p>=r.y){c('Scroll').setTop(n,n.scrollHeight);}else c('Scroll').setTop(n,o);this.notifyNub(j,'resize');},getMaxFlyoutHeight:function(j){var k=this._findFlyout(j),l=c('Vector').getElementPosition(k,'viewport'),m=c('Vector').getElementDimensions(k),n=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.getFlyoutHeightOffset())-(this.viewportDimensions.y-l.y-m.y);return Math.max(n,0);},resizeAllFlyouts:function(){var j=this._getAllNubs(),k=j.length;while(k--)this._resizeNubFlyout(j[k]);},hideAllFlyouts:function(){var j=this._getAllNubs(),k=j.length;while(k--)this.hide(j[k]);},_getAllNubs:function(){var j=c('DOM').scry(this.rootEl,"div._50-v.openToggler");return j.concat(c('DOM').scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var j=event.getTarget(),k=c('Parent').byClass(j,'fbNub');if(k){if(c('Parent').byClass(j,'fbNubFlyoutTitlebar')){var l=c('Parent').byTag(j,'a'),m=j.nodeName=='INPUT'&&j.getAttribute('type')=='submit';if(!l&&!m){this.hide(k);return false;}}this.notifyNub(k,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(j){return c('CSS').hasClass(j,'fbNubFlyout')?j:c('DOM').scry(j,'div.fbNubFlyout')[0]||null;},registerNubController:function(j,k){c('DataStore').set(j,'dock:nub:controller',k);k.subscribe('nub/button/content-changed',c('shield')(this.inform,this,'resize',j));k.subscribe('nub/flyout/content-changed',c('shield')(this._resizeNubFlyout,this,j));},unregisterNubController:function(j){c('DataStore').remove(j,'dock:nub:controller');},notifyNub:function(j,k,l){var m=c('DataStore').get(j,'dock:nub:controller');m&&m.inform(k,l);}});f.exports=b.Dock||i;},null);
__d('NubController',['ArbiterMixin','Dock'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){}Object.assign(h.prototype,c('ArbiterMixin'),{init:function(i){this.el=i;c('Dock').registerNubController(i,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){c('Dock').hide(this.el);},show:function(){c('Dock').show(this.el);}});f.exports=h;},null);
__d('DropdownContextualHelpLink',['DOM','ge'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={set:function(i){var j=c('ge')('navHelpCenter');if(j!==null)c('DOM').replace(j,i);}};f.exports=h;},null);
__d('MercuryMessageClientState',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i=c('AvailableList').getWebChatNotification&&c('AvailableList').getWebChatNotification(),j=h,k=true,l=Object.assign(new (c('Arbiter'))(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return i!==c('ChatNotificationConstants').NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return j;},showsTabUnreadUI:function(){return k;}});function m(){l.inform(l.ON_CHANGED);}c('AvailableList').subscribe&&c('AvailableList').subscribe(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,function(){var n=i,o=c('AvailableList').getWebChatNotification();i=o;if(n!=o)m();});c('Arbiter').subscribe('chat/set_does_page_occlude_tabs',function(n,o){j=!!o;m();});c('Arbiter').subscribe('chat/set_show_tab_unread_ui',function(n,o){k=!!o;m();});f.exports=l;},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','MercuryIDs','LogHistory','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('chat_cookie'),i=c('InitialServerTime').serverTime,j=c('ChatConfig').get('tab_max_load_age')||3600000,k=i-j,l={store:function(p,q){if(p.uct2==q.lastChangeTime)return p;var r=o(p,q),s={};if(!r){s.old_tabs=p&&p.t2&&JSON.stringify(p.t2);s.old_promoted=p&&p.lm2;s.old_time=p&&p.uct2;s.old_reason=p&&p.tr;s.old_window=p&&p.tw;var t=[];q.tabs.forEach(function(u){if(!u.fragile||u.server_id){var v={i:u.fragile?c('MercuryIDs').getThreadIDFromThreadFBID(u.server_id):u.id,si:u.server_id};if(u.raised)v.r=1;t.push(v);}});p.t2=t;p.lm2=q.promotedID;p.uct2=q.lastChangeTime;p.tr=q.lastChangeReason;p.tw=c('PresenceUtil').getSessionID();h.debug('store','{}');}else h.warn('store_bad_state','{}');return p;},load:function(p,q){if(!p){h.warn('load_bad_state','{}');return false;}var r=o(p,q);if(!r||r===q.lastChangeTime)return false;q.lastChangeTime=r;q.lastChangeReason='load';var s=m(q,p.t2,p.lm2||null),event='load';if(!q.isInitialized)event+='_init';h.log(event,'{}');return s;},tabsChanged:function(){return n.apply(undefined,arguments);}};function m(p,q,r){var s;if(!n(p,q,r))return false;var t=p.tabs.filter(function(w){return !!w.fragile;}),u={};p.promotedID=null;p.tabs=q.map(function(w){var x={id:w.i,server_id:w.si};if(x.id==r)p.promotedID=x.id;if(w.r)x.raised=true;var y=t.find(function(z){return z.server_id&&z.server_id===x.server_id;});if(y){if(x.raised){y.raised=true;}else delete y.raised;t=t.filter(function(z){return !z.server_id||z.server_id!==x.server_id;});t.push(y);return null;}u[x.id]=x;return x;});p.tabs=p.tabs.filter(function(w){return !!w;});if(p.localRaised)for(var v in p.localRaised)if(!u[v]||!u[v].raised)delete p.localRaised[v];t=t.filter(function(w){return !u[w.id];});(s=p.tabs).push.apply(s,t);return true;}function n(p,q,r){if(r&&r!=p.promotedID)return true;var s=p.tabs.filter(function(v){return !v.fragile||v.server_id;});if(q.length!=s.length)return true;for(var t=0,u=q.length;t<u;t++)if(!!q[t].r!==s[t].raised||!q[t].si&&q[t].i!==s[t].id||q[t].si&&q[t].si!==s[t].server_id)return true;return false;}function o(p,q){var r=c('PresenceState').verifyNumber(p.uct2);if(!r||typeof r!=='number'){h.warn('bad_cookie_version','{}');return null;}if(r<q.lastChangeTime||r<k)return null;return r;}f.exports=l;},null);
__d('MercuryAssert',['MercuryIDs'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={isParticipantID:function(h){if(!c('MercuryIDs').isValid(h))throw 'bad_participant_id '+h;},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=c('MercuryIDs').tokenize(h);if(i.type!='fbid')throw 'bad_user_id '+h;},isEmailParticipantID:function(h){var i=c('MercuryIDs').tokenize(h);if(i.type!='email')throw 'bad_email_id '+h;},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!c('MercuryIDs').isValid(h))throw 'bad_thread_id '+h;}};},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={generateMessageID:function(j){var k=j||Date.now(),l=c('randomInt')(0,4294967295),m=c('PresenceUtil').getSessionID();return '<'+k+':'+l+'-'+m+'@mail.projektitan.com>';},generateThreadID:function(j){return 'root:'+h.generateOfflineThreadingID(j);},generateOfflineThreadingID:function(j){var k=j||Date.now(),l=c('randomInt')(0,4294967295),m=('0000000000000000000000'+l.toString(2)).slice(-22),n=k.toString(2)+m;return i(n.slice(-63));}};function i(j){var k='';while(j!='0'){var l=0,m='';for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+='1';l-=10;}else m+='0';}k=l.toString()+k;j=m.slice(m.indexOf('1'));}return k;}f.exports=h;},null);
__d('EmojiLikeConstants',['EmojiStaticConfig'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('EmojiStaticConfig').sizeMap,i={XSMALL:'xsmall',SMALL:'small',MEDIUM:'medium',LARGE:'large'},j=[983040],k='hot_emoji_size',l='emoji_like',m='\uD83D\uDC4D',n=[128077];f.exports={FB_THUMBS_UP_EMOJI:j,size:i,sizeMap:h,TAG_PREFIX_NEW:k,TAG_PREFIX_OLD:l,THUMBS_UP_EMOJI:m,THUMBS_UP_EMOJI_CODES:n};},null);
__d('EmojiFormat',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j){return j.split('_').map(function(k){return parseInt(k,16);});}function i(j){return j.map(function(k){return k.toString(16);}).join('_');}f.exports={codeArrayToCodeString:i,codeStringToCodeArray:h};},null);
__d('SkinToneEmoji',['EmojiFormat','MessengerEmojiConfig'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=65039,i={'261d':1,'26f9':1,'270a':1,'270b':1,'270c':1,'270d':1,'1f385':1,'1f3c3':1,'1f3c4':1,'1f3ca':1,'1f3cb':1,'1f442':1,'1f443':1,'1f446':1,'1f447':1,'1f448':1,'1f449':1,'1f44a':1,'1f44b':1,'1f44c':1,'1f44d':1,'1f44e':1,'1f44f':1,'1f450':1,'1f466':1,'1f467':1,'1f468':1,'1f469':1,'1f46e':1,'1f470':1,'1f471':1,'1f472':1,'1f473':1,'1f474':1,'1f475':1,'1f476':1,'1f477':1,'1f478':1,'1f47c':1,'1f481':1,'1f482':1,'1f483':1,'1f485':1,'1f486':1,'1f487':1,'1f4aa':1,'1f575':1,'1f590':1,'1f595':1,'1f596':1,'1f645':1,'1f646':1,'1f647':1,'1f64b':1,'1f64c':1,'1f64d':1,'1f64e':1,'1f64f':1,'1f6a3':1,'1f6b4':1,'1f6b5':1,'1f6b6':1,'1f6c0':1,'1f918':1};function j(s){if(s[s.length-1]===h)return s[s.length-1];return 0;}function k(s){if(s[s.length-1]===h)return s;var t=s.slice(0);t.push(h);return t;}function l(s){if(j(s)===0)return s;return s.slice(0,s.length-1);}function m(s){return p(l(s));}function n(s){var t=c('EmojiFormat').codeArrayToCodeString(m(s));return !!i[t];}function o(s,t){if(t===0)return s;var u=j(s),v=u===0?s.slice(0):s.slice(0,s.length-1);if(q(v)!==0)return s;v.push(t);if(u!==0)v.push(u);return v;}function p(s){var t=j(s),u=t===0?q(s):q(s.slice(0,s.length-1));if(u===0)return s;return t===0?s.slice(0,s.length-1):k(s.slice(0,s.length-2));}function q(s){var t=l(s);if(t.length<=1||!r(t[t.length-1]))return 0;return t[t.length-1];}function r(s){return c('MessengerEmojiConfig').emoji_colors.filter(function(t){return t===s;}).length!==0;}f.exports={addEmojiModifier:k,applyTone:o,getEmojiModifier:j,getTone:q,removeEmojiModifier:l,removeTone:p,emoji:i,hasVariations:n};},null);
__d('EmojiLikeCxData',['cx','EmojiFormat','EmojiImageURL','EmojiLikeConstants','Image.react','MercuryConfig','MessengerSupportedEmoji','React','SkinToneEmoji','Utf16','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('EmojiLikeConstants').size,j=c('EmojiLikeConstants').sizeMap,k=new RegExp('([\u00A9\u00AE\u203C\u2049\u2100-\u21FF'+'\u2300-\u27FF\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uDB80[\uDC00-\uDC01]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),l=new RegExp('([\u0023\u0030-\u0039][\uFE00-\uFE0F]?'+'\u20E3|[\u261D\u270A-\u270C]\uD83C[\uDFFB-\uDFFF]|[\uD83C\uD83D]'+'[\uDC00-\uDFFF]\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDDE6-\uDDFF]\uD83C'+'[\uDDE6-\uDDFF])([\uFE00-\uFE0F])?'),m=new RegExp('(\u20E3|\uD83C[\uDFFB-\uDFFF])'+'([\uFE00-\uFE0F])?'),n=new RegExp('(\uD83C[\uDDE6-\uDDFF])'+'([\uFE00-\uFE0F])?'),o=new RegExp('([\uFE00-\uFE0F])'),p=new RegExp('([\uFE0F])'),q=new RegExp('(\uD83D[\uDC68\uDC69]\u200D)'+'(\uD83D[\uDC68\uDC69]\u200D\uD83D[\uDC66\uDC67]\u200D|'+'\uD83D[\uDC68\uDC69]\u200D|'+'\u2764\uFE0F\u200D\uD83D\uDC8B\u200D|'+'\u2764\uFE0F\u200D)'+'(\uD83D[\uDC66-\uDC69])'),r=new RegExp('([\u200D])'),s='fe0f';function t(){var x;return x={},x[i.XSMALL]="_2560",x[i.SMALL]="_1ifu",x[i.MEDIUM]="_19_r",x[i.LARGE]="_19_s",x;}function u(x,y){if(!c('MercuryConfig').MessengerNewEmojiGK)return false;var z=t(),aa={},ba='',ca=null,da=null,ea=null,fa=q.exec(x);if(fa&&fa.index>0||!fa){da=k.exec(x);ea=l.exec(x);}if(da&&da.length&&ea&&ea.length)if(da.index<ea.index){ea=null;}else da=null;if(da&&fa){fa=da.index<fa.index?null:fa;}else if(ea&&fa)fa=ea.index<fa.index?null:fa;if(fa&&fa.length){var ga=fa[0],ha=ga.split(r).map(function(pa){if(p.test(pa)){pa=pa.replace(p,'');return c('Utf16').decode(pa).toString(16)+'_'+s;}return c('Utf16').decode(pa).toString(16);});ba=ha.join('_');ca=c('MessengerSupportedEmoji').emoji[ba];}if(da&&da.length){var ia=da[1];ba=c('Utf16').decode(ia).toString(16);ca=c('MessengerSupportedEmoji').emoji[ba];}else if(ea&&ea.length){var ja=ea[1],ka=n.exec(ja),la='',ma='';if(ka&&ka.length){la=ka[1];ma=ja.replace(n,'');}else{var na=m.exec(ja);ma=na[1];la=ja.replace(m,'');if(o.test(la))la=la.replace(o,'');}ba=c('Utf16').decode(la).toString(16)+'_'+c('Utf16').decode(ma).toString(16);ca=c('MessengerSupportedEmoji').emoji[ba];}if(!ca)return false;var oa=c('joinClasses')(z[y],"_1ift");aa.id=ba;aa.url=c('EmojiImageURL').getMessengerURL(ba,j[y]);aa.emoji=c('React').createElement(c('Image.react'),{className:oa,src:aa.url});return aa;}function v(x,y){if(x.endsWith(s))x=x.replace('_'+s,'');if(!c('MessengerSupportedEmoji').emoji[x])return null;var z=c('EmojiFormat').codeStringToCodeArray(x),aa=c('EmojiFormat').codeArrayToCodeString(c('SkinToneEmoji').removeEmojiModifier(z));return c('EmojiImageURL').getMessengerURL(aa,j[y]);}function w(x,y){var z=t(),aa=c('joinClasses')(z[y],"_1ift"),ba=c('React').createElement(c('Image.react'),{className:aa,src:v(x,y)});return ba;}f.exports={emoji:c('MessengerSupportedEmoji').emoji,getClassSizeMap:t,getNewEmojiData:u,getUrl:v,renderFromSize:w};},null);
__d('MercuryTagHelper',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={get:function(i,j){var k=i.find(function(l){return l.startsWith(j);});return k&&k.substr(k.indexOf(':')+1);}};f.exports=h;},null);
__d('EmojiLikeUtils',['EmojiLikeConstants','EmojiLikeCxData','EmoticonsList','EmoticonEmojiList','MercuryConfig','MercuryTagHelper','SupportedEmoji','Utf16'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('EmojiLikeConstants').size,k='/images/emoji/unicode/emoji_',l='/images/emoticons/',m=(h={},h[j.SMALL]='_16-2x',h[j.MEDIUM]='_64',h[j.LARGE]='_64',h),n=(i={},i[j.MEDIUM]='-2x',i),o='.png',p='emoji',q='emoticon',r='text',s=new RegExp('([\u203C\u2049\u2100-\u21FF\u2300-\u27FF'+'\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),t=new RegExp('([\u00A9\u00AE\u203C\u2049\u2100-\u21FF'+'\u2300-\u27FF\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),u=new RegExp('([\u0023\u0030-\u0039][\uFE00-\uFE0F]?'+'\u20E3|[\u261D\u270A-\u270C]\uD83C[\uDFFB-\uDFFF]|[\uD83C\uD83D]'+'[\uDC00-\uDFFF]\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDDE6-\uDDFF]\uD83C'+'[\uDDE6-\uDDFF])([\uFE00-\uFE0F])?'),v=new RegExp('(\u20E3|\uD83C[\uDFFB-\uDFFF])'+'([\uFE00-\uFE0F])?'),w=new RegExp('(\uD83C[\uDDE6-\uDDFF])'+'([\uFE00-\uFE0F])?'),x=new RegExp('([\uFE00-\uFE0F])'),y=new RegExp('([\uFE0F])'),z=new RegExp('(\uD83D[\uDC68\uDC69]\u200D)'+'(\uD83D[\uDC68\uDC69]\u200D\uD83D[\uDC66\uDC67]\u200D|'+'\uD83D[\uDC68\uDC69]\u200D|'+'\u2764\uFE0F\u200D\uD83D\uDC8B\u200D|'+'\u2764\uFE0F\u200D)'+'(\uD83D[\uDC66-\uDC69])'),aa=new RegExp('([\u200D])'),ba=new RegExp('(\r\n|[ \r\n]|\s)'),ca='fe0f',da=function(ka){if(!c('MercuryConfig').BubblelessEmojiRenderingGK)return false;var la=ka||'',ma=[],na=null;while(la.length>0&&la.trim().length>0){var oa=ba.exec(la),pa='';while(oa&&oa.length&&oa.index===0){pa+=oa[0];la=la.replace(ba,'');oa=ba.exec(la);}if(pa.length>0)ma.push({type:r,text:pa});if(c('MercuryConfig').MessengerNewEmojiGK){if(c('EmoticonEmojiList').noncapturingRegexp.test(la)){na=c('EmoticonEmojiList').noncapturingRegexp.exec(la);var qa=c('EmoticonEmojiList').names[na[1]],ra=c('EmoticonEmojiList').emote2emojis[qa];ma.push({emoji:c('EmojiLikeCxData').renderFromSize(ra,j.SMALL),type:p,title:na[1],id:ra});la=la.replace(c('EmoticonEmojiList').noncapturingRegexp,'');}else{var sa=null,ta=null,ua=z.exec(la);if(ua&&ua.index>0||!ua){sa=t.exec(la);ta=u.exec(la);}if(sa&&sa.length&&ta&&ta.length)if(sa.index<ta.index){ta=null;}else sa=null;if(sa&&ua){ua=sa.index<ua.index?null:ua;}else if(ta&&ua)ua=ta.index<ua.index?null:ua;if(ua&&ua.length){var va=ua[0],wa=va.split(aa).map(function(jb){if(y.test(jb)){jb=jb.replace(y,'');return c('Utf16').decode(jb).toString(16)+'_'+ca;}return c('Utf16').decode(jb).toString(16);}),xa=wa.join('_'),ya=c('EmojiLikeCxData').emoji[xa];if(!ya)return false;ma.push({emoji:c('EmojiLikeCxData').renderFromSize(xa,j.SMALL),id:xa,type:p});la=la.replace(z,'');continue;}if(ta&&ta.length){na=ta[1];var za=w.exec(na),ab='',bb='';if(za&&za.length){ab=za[1];bb=na.replace(w,'');}else{var cb=v.exec(na);bb=cb[1];ab=na.replace(v,'');if(x.test(ab))ab=ab.replace(x,'');}var db=c('Utf16').decode(ab).toString(16)+'_'+c('Utf16').decode(bb).toString(16),eb=c('EmojiLikeCxData').emoji[db];if(!eb)return false;ma.push({emoji:c('EmojiLikeCxData').renderFromSize(db,j.SMALL),id:db,type:p});la=la.replace(u,'');}else if(sa&&sa.length){na=sa[1];var fb=c('Utf16').decode(na).toString(16),gb=c('EmojiLikeCxData').emoji[fb];if(!gb)return false;ma.push({emoji:c('EmojiLikeCxData').renderFromSize(fb,j.SMALL),id:fb,type:p});la=la.replace(t,'');}else return false;}}else if(c('EmoticonsList').noncapturingRegexp.test(la)){na=c('EmoticonsList').noncapturingRegexp.exec(la);ma.push({emoji:undefined,type:q,title:na[1],id:c('EmoticonsList').emotes[na[1]]});la=la.replace(c('EmoticonsList').noncapturingRegexp,'');}else if(s.test(la)){var hb=s.exec(la);if(!hb||!hb.length)return false;na=hb[1];var ib=c('Utf16').decode(na).toString(16);if(!c('SupportedEmoji').emoji[ib])return false;ma.push({emoji:undefined,id:ib,type:p});la=la.replace(s,'');}else return false;}return ma;};function ea(ka,la){ka.tags=[fa(la)];return ka;}function fa(ka){var la=c('MercuryConfig').WWWMessengerNewEmojiSizeTagGK?c('EmojiLikeConstants').TAG_PREFIX_NEW:c('EmojiLikeConstants').TAG_PREFIX_OLD;return la+':'+ka;}function ga(ka){return ha(ka)!=null;}function ha(ka){if(!ka.tags)return null;var la=c('MercuryTagHelper').get(ka.tags,c('EmojiLikeConstants').TAG_PREFIX_NEW);if(la)return la;return c('MercuryTagHelper').get(ka.tags,c('EmojiLikeConstants').TAG_PREFIX_OLD);}function ia(ka,la){if(!c('SupportedEmoji').findEmoji(ka))return null;return (k+c('Utf16').decode(ka).toString(16)+m[la]+o);}function ja(ka){var la=j.LARGE,ma=j.MEDIUM,na=[];if(ka)ka.forEach(function(oa){if(oa.type===p){na.push({emoji:oa.emoji,text:oa.text,title:oa.title,type:oa.type,url:k+oa.id+m[la]+o});}else if(oa.type===q){na.push({emoji:undefined,text:oa.text,title:oa.title,type:oa.type,url:l+oa.id+n[ma]+o});}else na.push({emoji:undefined,text:oa.text,title:oa.title,type:oa.type,url:''});});return na;}f.exports={getEmojiSize:ha,getURI:ia,getSourceURIs:ja,isEmojiLike:ga,richContent:da,setEmojiSize:ea,EMOJI_TYPE:p,EMOTE_TYPE:q,TEXT_TYPE:r};},null);
__d('MercuryAttachment',['cx','EmojiLikeUtils','MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','MercuryConfig','MercuryTagHelper'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={getAttachIconClass:function(j){switch(j){case c('MercuryAttachmentContentType').PHOTO:return "_y2-";case c('MercuryAttachmentContentType').VIDEO:return "_y2_";case c('MercuryAttachmentContentType').MUSIC:return "_y30";case c('MercuryAttachmentContentType').VOICE:return "_y31";case c('MercuryAttachmentContentType').TEXT:return "_y32";case c('MercuryAttachmentContentType').MSWORD:return "_y33";case c('MercuryAttachmentContentType').MSXLS:return "_y34";case c('MercuryAttachmentContentType').MSPPT:return "_y35";}return "_y36";},getAttachIconClassByMime:function(j){if(j.startsWith('image')){return "_y2-";}else if(j.startsWith('video')){return "_y2_";}else if(j.startsWith('audio')){return "_y30";}else if(j.startsWith('text/plain')){return "_y32";}else return "_y36";},getAttachTypeByMime:function(j){if(j.startsWith('image')){return c('MercuryAttachmentContentType').PHOTO;}else if(j.startsWith('video')){return c('MercuryAttachmentContentType').VIDEO;}else if(j.startsWith('audio')){return c('MercuryAttachmentContentType').MUSIC;}else if(j.startsWith('text/plain')){return c('MercuryAttachmentContentType').TEXT;}else return c('MercuryAttachmentContentType').UNKNOWN;},convertRaw:function(j){var k=[];for(var l=0;l<j.length;l++){var m=j[l];if(m.attach_type===c('MercuryAttachmentType').PHOTO){k.push(m);}else if(m.filename){var n=i.getAttachTypeByMime(m.filetype),o={};o.attach_type=c('MercuryAttachmentType').FILE;o.name=m.filename;o.icon_type=n;o.url='';k.push(o);}}return k;},get:function(j){var k=[];if(j.attachments){k=j.attachments;}else if(j.raw_attachments)k=this.convertRaw(j.raw_attachments);var l=c('EmojiLikeUtils').getEmojiSize(j);if(l)k=k.concat([{attach_type:c('MercuryAttachmentType').EMOJI_LIKE,size:l}]);if(!(j.attachments&&j.attachments.length>0)){if(j.sticker_id)return k.concat([{attach_type:c('MercuryAttachmentType').STICKER}]);if(j.preview_attachments&&j.preview_attachments.length>0)return k.concat(j.preview_attachments);}return k;},resizeContain:function(j,k){var l=j.width/j.height,m=k.width/k.height;if(m<l){return {width:Math.ceil(Math.min(j.height*m,k.width)),height:Math.ceil(Math.min(j.height,k.height))};}else return {width:Math.ceil(Math.min(j.width,k.width)),height:Math.ceil(Math.min(j.width/m,k.height))};},isBubblePreferred:function(j){return c('MercuryConfig').ChatMessengerStyles?this.isFileAttachment(j):!(this.isPhotoAttachment(j)||this.isStickerAttachment(j)||this.isVideoAttachment(j)||this.isVoiceAttachment(j));},isEphemeralAttachmentStyle:function(j){return (this.isPhotoAttachment(j)||this.isVideoAttachment(j));},isEphemeralTextStyle:function(j){return (this.isErrorAttachment(j)||this.isShareAttachment(j)||this.isFileAttachment(j));},isPhotoAttachment:function(j){return !!(j.attach_type==c('MercuryAttachmentType').PHOTO||j.attach_type==c('MercuryAttachmentType').ANIMATED_IMAGE||j.attach_type==c('MercuryAttachmentType').THIRDPARTYSTICKER||j.attach_type==c('MercuryAttachmentType').FILE&&j.preview_url);},isVideoAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').VIDEO;},isShareAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').SHARE;},isFileAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').FILE;},isErrorAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').ERROR;},isStickerAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').STICKER;},isEmojiLikeAttachment:function(j){return j.attach_type===c('MercuryAttachmentType').EMOJI_LIKE;},isVoiceAttachment:function(j){if(!j.metadata)return false;return (j.metadata.type===c('MercuryAudioType').AudioClip||j.metadata.type===c('MercuryAudioType').VoiceMessageWithTranscript);},hasAttribution:function(j){return !!j.app_attribution;}};f.exports=i;},null);
__d('MercurySingletonProvider',['CurrentUser'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){this.$MercurySingletonProvider1={};this.$MercurySingletonProvider2=i;}h.prototype.getForFBID=function(i){if(!this.$MercurySingletonProvider1[i])this.$MercurySingletonProvider1[i]=new this.$MercurySingletonProvider2(i);return this.$MercurySingletonProvider1[i];};h.prototype.get=function(){return this.getForFBID(c('CurrentUser').getID());};h.mock=function(i){throw new Error('MercurySingletonProvider.mock() must only be used in tests.');};f.exports=h;},null);
__d('MercuryThreadInformer',['ArbiterMixin','LogHistory','MercuryAssert','MercurySingletonProvider','mapObject','mixin'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('LogHistory').getInstance('mercury_informer');h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.get=function(){return l.get();};k.getForFBID=function(m){return l.getForFBID(m);};function k(m){i.constructor.call(this);this.$MercuryThreadInformer1=m;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5={};this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8=false;this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11={};this.$MercuryThreadInformer12=0;}k.prototype.updatedThread=function(m){this.$MercuryThreadInformer3[m]=true;this.$MercuryThreadInformer13();};k.prototype.invalidatedThread=function(m){this.$MercuryThreadInformer4[m]=true;this.$MercuryThreadInformer13();};k.prototype.deletedThread=function(m){this.$MercuryThreadInformer2[m]=true;this.$MercuryThreadInformer13();};k.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformer13();};k.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer7=true;this.$MercuryThreadInformer13();};k.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer8=true;this.$MercuryThreadInformer13();};k.prototype.changedThreadReadState=function(m,n,o){if(!this.$MercuryThreadInformer5[m]||this.$MercuryThreadInformer5[m].timestamp<o)this.$MercuryThreadInformer5[m]={mark_as_read:n,timestamp:o};this.$MercuryThreadInformer13();};k.prototype.receivedMessage=function(m){c('MercuryAssert').isThreadID(m.thread_id);var n=m.thread_id;if(!this.$MercuryThreadInformer9[n])this.$MercuryThreadInformer9[n]=[];this.$MercuryThreadInformer9[n].push(m);this.updatedThread(n);};k.prototype.reorderedMessages=function(m,n){this.$MercuryThreadInformer10[m]={source:n};this.$MercuryThreadInformer13();};k.prototype.updatedMessage=function(m,n,o){if(!this.$MercuryThreadInformer11[m])this.$MercuryThreadInformer11[m]={};this.$MercuryThreadInformer11[m][n]={source:o};this.updatedThread(m);};k.prototype.synchronizeInforms=function(m){this.$MercuryThreadInformer12++;try{m();}catch(n){throw n;}finally{this.$MercuryThreadInformer12--;this.$MercuryThreadInformer13();}};k.prototype.listen=function(m,n){return this.subscribe('threads-updated',function(o,p){if(p[m])n(m);});};k.prototype.$MercuryThreadInformer13=function(){if(!this.$MercuryThreadInformer12){var m=this.$MercuryThreadInformer2,n=this.$MercuryThreadInformer3,o=this.$MercuryThreadInformer4,p=this.$MercuryThreadInformer5,q=this.$MercuryThreadInformer6,r=this.$MercuryThreadInformer7,s=this.$MercuryThreadInformer8,t=this.$MercuryThreadInformer9,u=this.$MercuryThreadInformer10,v=this.$MercuryThreadInformer11;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5={};this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8=false;this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11={};var w=Object.keys(n);if(w.length||q)this.inform('threadlist-updated',w);if(w.length)this.$MercuryThreadInformer14('threads-updated',n);for(var x in o){this.$MercuryThreadInformer14('thread-invalidated',o);break;}for(var x in p){this.$MercuryThreadInformer14('thread-read-changed',p);break;}for(x in m){this.$MercuryThreadInformer14('threads-deleted',m);break;}if(r)this.$MercuryThreadInformer14('unseen-updated',null);if(s)this.$MercuryThreadInformer14('unread-updated',null);for(x in t){this.$MercuryThreadInformer14('messages-received',t);break;}for(x in u){this.$MercuryThreadInformer14('messages-reordered',u);break;}for(x in v){this.$MercuryThreadInformer14('messages-updated',v);break;}}};k.prototype.$MercuryThreadInformer14=function(m,n){j.debug(m,'{}');this.inform(m,n);};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;},null);
__d('MercuryDispatcher',['invariant','ArbiterMixin','LogHistory','MercuryActionType','MercuryLoggingHelper','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadInformer','isEmpty','mixin'],function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('LogHistory').getInstance('mercury_dispatcher');i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){j.constructor.call(this);this.$MercuryDispatcher1=n;}l.prototype.handleUpdate=function(n){this.$MercuryDispatcher2(n);!(!!n.from_client!==!!n.preprocessed)?h(0):void 0;delete n.preprocessed;if(!c('isEmpty')(n))c('MercuryThreadInformer').getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)this.inform('invalidate-global-state',{});if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE){var o=n.threads&&n.threads.length>0&&n.threads[0]&&n.threads[0].thread_id;if(o)this.inform('invalidate-thread-state',o);}this.inform('update-thread-ids',n.newlyAddedClientIDs||{});this.inform('update-participants',n);this.inform('update-threads',n);this.inform('update-unread',n);this.inform('update-threadlist',n);this.inform('update-messages',n);this.inform('update-unseen',n);this.inform('update-typing-state',n);this.inform('update-delivery',n);this.inform('update-roger',n.roger);this.inform('update-blocked-users',n);this.inform('model-update-completed',null);}.bind(this));};l.prototype.$MercuryDispatcher2=function(n){var o=n.payload_source;if(o===c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS||o===c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN)return;var p={from_client:n.from_client,messages:null};if(n.actions){var q=n.actions.filter(function(r){return (r.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE||r.action_type===c('MercuryActionType').LOG_MESSAGE);}).map(function(r){return {action_type:r.action_type,other_user_fbid:r.other_user_fbid,thread_fbid:r.thread_fbid,message_id:r.message_id};});if(q.length)p.messages=q;}k.debug('update:'+o,JSON.stringify(p));};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;},null);
__d('MercurySendErrorLogger',['Banzai','BanzaiLogger'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('BanzaiLogger').create({retry:true}),i=c('Banzai').isEnabled('mercury_send_error_logging'),j={log:function(k){if(!i)return;var l={message_id:k.message_id,timestamp_client:Date.now(),error_type:k.error_data.type,error_code:k.error_data.code,error_description:k.error_data.description,is_transient:k.error_data.is_transient};h.log('MercurySendErrorLoggerConfig',l);}};f.exports=j;},null);
__d('MercuryServerPayloadPreprocessor',['invariant','CurrentEnvironment','MercuryIDs','MercuryConfig','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonProvider','MercuryThreadIDMap','URI'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(k){this.$MercuryServerPayloadPreprocessor1=k;this.$MercuryServerPayloadPreprocessor2=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=c('MercuryDispatcher').getForFBID(this.$MercuryServerPayloadPreprocessor1);}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};i.prototype.handleUpdate=function(k){var l={};!!k.from_client?h(0):void 0;(k.threads||[]).forEach(function(da){this.$MercuryServerPayloadPreprocessor4(da,l);var ea=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(da.thread_id);e(['MercuryServerRequests'],function(fa){var ga=fa.getForFBID(this.$MercuryServerPayloadPreprocessor1);ga.markThreadFetched(da.thread_id);if(ea)ga.markThreadFetched(ea);ga.updateLastActionTimestamp(da.timestamp);}.bind(this));}.bind(this));(k.ordered_threadlists||[]).forEach(function(da){var ea=da.thread_fbids||[];ea=ea.concat(da.other_user_fbids||[]);da.thread_ids=ea.map(function(fa){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(fa.toString());}.bind(this));}.bind(this));if(k.pinned_threads&&k.pinned_threads.thread_fbids)k.pinned_threads.thread_fbids=k.pinned_threads.thread_fbids.map(function(da){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(da);}.bind(this));if(k.delivery_receipts){var m={};for(var n=k.delivery_receipts,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q,s=r.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(r.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(r.thread_fbid);if(s)m[s]=r.time;}k.delivery_receipts=m;}k.actions=k.actions||[];k.actions.forEach(function(da){if(da.action_type===c('MercuryActionType').SEND_MESSAGE&&da.status===c('MercuryActionStatus').ERROR)c('MercurySendErrorLogger').log(da);var ea=null,fa=null;if(da.other_user_fbid){fa=c('MercuryIDs').getThreadIDFromUserID(da.other_user_fbid);ea=da.other_user_fbid;}else if(da.thread_fbid){fa=c('MercuryIDs').getThreadIDFromThreadFBID(da.thread_fbid);ea=da.thread_fbid;}else if(da.thread_id){fa=c('MercuryIDs').getThreadIDFromThreadFBID(da.thread_id);ea=da.thread_id;}else if(da.status&&da.status!=c('MercuryActionStatus').SUCCESS&&da.client_thread_id){fa=da.client_thread_id;}else h(0);ea=ea&&ea.toString();da.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(ea)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ea):fa;if(da.action_type==c('MercuryActionType').SEND_MESSAGE&&da.client_thread_id&&ea){da.thread_id=da.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(ea,da.client_thread_id);l[ea]=da.client_thread_id;}!da.thread_id?h(0):void 0;if(!k.payload_source||!k.payload_source.startsWith('server'))e(['MercuryServerRequests'],function(ga){ga.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(da.timestamp);}.bind(this));}.bind(this));this.$MercuryServerPayloadPreprocessor5(k);this.$MercuryServerPayloadPreprocessor6(k);if(k.end_of_history){var t=[];for(var u=0;u<k.end_of_history.length;u++){var v=k.end_of_history[u];if(v.type=='user'){t.push('user:'+v.fbid);}else if(v.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(v.fbid))t.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(v.fbid));}k.end_of_history=t;}if(k.roger){var w={};for(var x in k.roger){var y=Object.keys(k.roger[x]),z=void 0;if(x){z=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);}else if(y.length===1)z=c('MercuryIDs').getThreadIDFromUserID(y[0]);if(z){var aa=k.roger[x];w[z]={};for(var ba in aa)if(aa.hasOwnProperty(ba)){var ca=c('MercuryIDs').getParticipantIDFromUserID(ba);w[z][ca]=aa[ba];}}}k.roger=w;}k.newlyAddedClientIDs=l;k.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(k);};i.prototype.$MercuryServerPayloadPreprocessor4=function(k,l){var m=k.other_user_fbid?k.other_user_fbid:k.thread_fbid;!m?h(0):void 0;var n=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(m);if(!n){n=k.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(k.other_user_fbid):c('MercuryIDs').getThreadIDFromThreadFBID(k.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(m,n);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(k.thread_id,n);l[m]=n;}k.thread_id=n;};i.prototype.$MercuryServerPayloadPreprocessor5=function(k){k.actions.forEach(function(l){if(l.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE){l.attachments=l.attachments||[];l.attachments.forEach(function(m){if(c('MercuryAttachment').isShareAttachment(m)&&c('CurrentEnvironment').messengerdotcom){var n=new (c('URI'))(m.share.uri);if(!n.getDomain())m.share.uri=n.setDomain('facebook.com').setSubdomain(c('URI').getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};i.prototype.$MercuryServerPayloadPreprocessor6=function(k){if(!c('MercuryConfig').MercuryGenieRendering)return;k.actions.forEach(function(l){if(l.action_type!==c('MercuryActionType').USER_GENERATED_MESSAGE)return;var m=l;if(!m.has_attachment||!m.attachments)return;for(var n=m.attachments.length-1;n>=0;n-=1){var o=m.attachments[n];if(!o.share||!o.share.style_list||o.share.style_list[0]!='genie_message')continue;if(o.share.target.genie_id)m.author=c('MercuryIDs').getParticipantIDFromUserID(o.share.target.genie_id);if(o.share.target&&!o.share.target.attachment){m.attachments.splice(n,1);m.has_attachment=m.attachments.length>0;}}});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;},null);
__d('FBID',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={isUser:function(i){return i<2.2e+09||i>=1e+14&&i<=100099999989999||i>=8.9e+13&&i<=89999999999999||i>=6.000001e+13&&i<=60000019999999;}};f.exports=h;},null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new (c('KeyedCallbackManager'))(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('id')===-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};f.exports=i;},null);
__d('MercuryServerSendMessageQueueOptions',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n){'use strict';this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;},null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=9999,i={create:function(j){var k=new (c('AsyncRequest'))(this.endpoint_uri).setData({message_batch:[j],client:this.client}),l=new (c('AsyncResponse'))(k,{});Object.assign(l,{error:h,silentError:false,transientError:true,request:k});return l;}};f.exports=i;},null);
__d("XMessagingSendController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/send\/",{});},null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryConfig','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError','XMessagingSendController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='/ajax/mercury/send_messages.php',i=c('LogHistory').getInstance('mercury_server_send_message_queue');function j(k,l,m,n){var o;'use strict';this.pending_message=null;this.queue=[];this.sender_id=k;this.queue_id=l;this.$MercuryServerSendMessageQueue2=m.success_handler;this.$MercuryServerSendMessageQueue1=m.error_handler;this.$MercuryServerSendMessageQueue4=m.transport_error_handler;this.$MercuryServerSendMessageQueue3=m.timeout_handler;this.client=n;var p=null;if(c('MercuryServerRequestsConfig').msgrRegion)p={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var q=c('MercuryConfig').MercuryUseXController?c('XMessagingSendController').getURIBuilder().getURI().toString():h,r=(o={},o[q]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:p,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:m.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:m.connection_retries},o);c('MercuryServerDispatcher').registerEndpoints(r);}j.prototype.enqueue=function(k){'use strict';this.queue.push(k);this.$MercuryServerSendMessageQueue5();};j.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();var k=c('MercuryConfig').MercuryUseXController?c('XMessagingSendController').getURIBuilder().getURI().toString():h,l={message_batch:[this.pending_message],client:this.client};if(c('MercuryConfig').MercuryUseXController){l={client:this.client,action_type:this.pending_message.action_type,app_id:this.pending_message.app_id,audio_ids:this.pending_message.audio_ids,body:this.pending_message.body,client_thread_id:this.pending_message.client_thread_id,content_attachment:this.pending_message.content_attachment,ephemeral_ttl_mode:this.pending_message.ephemeral_ttl_mode,file_ids:this.pending_message.file_ids,force_sms:this.pending_message.force_sms,gif_ids:this.pending_message.gif_ids,has_attachment:this.pending_message.has_attachment,image_ids:this.pending_message.image_ids,log_message_data:this.pending_message.log_message_data,log_message_type:this.pending_message.log_message_type,message_id:this.pending_message.message_id,offline_threading_id:this.pending_message.offline_threading_id,other_user_fbid:this.pending_message.other_user_fbid,photo_fbids:this.pending_message.photo_fbids,shareable_attachment:this.pending_message.shareable_attachment,signature_id:this.pending_message.signatureID,source:this.pending_message.source,specific_to_list:this.pending_message.specific_to_list,sticker_id:this.pending_message.sticker_id,tags:this.pending_message.tags,thread_fbid:this.pending_message.thread_fbid,timestamp:this.pending_message.timestamp,ui_push_phase:this.pending_message.ui_push_phase,video_ids:this.pending_message.video_ids,platform_xmd:this.pending_message.platform_xmd};for(var m in l)if(l[m]===undefined||l[m]===null)delete l[m];}c('MercuryServerDispatcher').trySend(k,l,null,this.sender_id,this.queue_id);};j.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};j.prototype.$MercuryServerSendMessageQueue8=function(k){'use strict';this.$MercuryServerSendMessageQueue1(c('MercuryServerSendMessageQueueSimulatedError').create(k));i.error('mark_as_failed',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:c('MercuryLoggingHelper').obfuscateMessage(k)}));};j.prototype.handleSuccess=function(k,l){'use strict';this.$MercuryServerSendMessageQueue2(k,l);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};j.prototype.handleError=function(k){'use strict';this.$MercuryServerSendMessageQueue1(k);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};j.prototype.handleTransportError=function(k){'use strict';this.$MercuryServerSendMessageQueue4(k);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};j.prototype.handleTimeout=function(k){'use strict';this.$MercuryServerSendMessageQueue3(k);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};j.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';i.debug('maybe_send_next_pending_message',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:c('MercuryLoggingHelper').obfuscateMessage(this.pending_message),queue:this.queue.map(function(l){return c('MercuryLoggingHelper').obfuscateMessage(l);})}));var k='send_queue.delayed.queue_length.'+this.queue.length.toString();c('BanzaiODS').bumpEntityKey('chat.web',k);};f.exports=j;},null);
__d('MercurySingletonMixin',['CurrentUser'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(c('CurrentUser').getID());},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};f.exports=h;},null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_server_send_message_queue_router'),i='chat.web.send_queue_router';c('BanzaiODS').setEntitySample(i,.1);function j(k){'use strict';this.queues=new (c('Map'))();this.fbid=k;}j.prototype.enqueue=function(k,l,m,n){'use strict';var o=this.queues.get(k);if(o===undefined){o=new (c('MercuryServerSendMessageQueue'))(this.fbid,k,l,m);this.queues.set(k,o);h.debug('added queue',JSON.stringify({fbid:this.fbid,queue_id:k}));c('BanzaiODS').bumpEntityKey(i,'new_queue');}o.enqueue(n);};Object.assign(j,c('MercurySingletonMixin'));f.exports=j;},null);
__d('MercuryServerRequests',['errorCode','invariant','Arbiter','AsyncResponse','BanzaiODS','ChannelConstants','CurrentUser','FBID','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryThreadIDMap','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercurySingletonProvider','MercurySourceType','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','PageMessageEnumTag','MercuryServerDispatcher','MercuryServerSendMessageQueueOptions','createObjectFrom','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('LogHistory').getInstance('mercury_server'),k=c('MercuryAPIArgsSource').MERCURY,l=1000,m=30*1000;function n(y){return y.getError()?'_'+y.getError():'';}function o(y,z){var aa=babelHelpers['extends']({},y),ba=void 0;if(z.threads){if(!aa.threads)aa.threads={};for(ba in z.threads)aa.threads[ba]=Object.keys(c('createObjectFrom')((aa.threads[ba]||[]).concat(z.threads[ba])));}if(z.messages){if(!aa.messages)aa.messages={};for(ba in z.messages){if(!aa.messages[ba])aa.messages[ba]={};for(var ca in z.messages[ba])if(aa.messages[ba][ca]){aa.messages[ba][ca]=s(aa.messages[ba][ca],z.messages[ba][ca]);}else aa.messages[ba][ca]=z.messages[ba][ca];}}aa.client=y.client||z.client;return aa;}function p(y,z){var aa=Object.assign(c('createObjectFrom')(y.folders,true),c('createObjectFrom')(z.folders,true)),ba=y.client||z.client;return {folders:Object.keys(aa),client:ba};}function q(y,z){for(var aa in z)if(y[aa]&&typeof y[aa]==='object'){y[aa]=s(y[aa],z[aa]);}else if(z[aa]&&typeof z[aa]==='object'){var ba={};Object.assign(ba,z[aa]);y[aa]=ba;}return y;}function r(y,z){return z;}function s(y,z){var aa=y.offset<z.offset?y.offset:z.offset,ba=y.offset+y.limit,ca=z.offset+z.limit,da=ba>ca?ba:ca,ea=da-aa,fa=y.timestamp>z.timestamp?y.timestamp:z.timestamp;return {offset:aa,limit:ea,timestamp:fa};}function t(y,z){var aa=y.client||z.client,ba={ids:{},client:aa};Object.assign(ba.ids,y.ids,z.ids);return ba;}function u(y,z){var aa={},ba=void 0,ca=y.client||z.client;delete y.client;delete z.client;for(ba in y)Object.assign(aa,c('createObjectFrom')(y[ba],ba));for(ba in z)Object.assign(aa,c('createObjectFrom')(z[ba],ba));var da={client:ca};for(var ea in aa){ba=aa[ea];if(!da[ba])da[ba]=[];da[ba].push(ea);}return da;}function v(y,z){var aa=y.client||z.client,ba=c('createObjectFrom')(y.ids,true),ca=c('createObjectFrom')(z.ids,true),da=Object.assign(ba,ca);return {ids:Object.keys(da),client:aa};}function w(y){this.$MercuryServerRequests1=y;this.$MercuryServerRequests2=0;this.$MercuryServerRequests3={};this.$MercuryServerRequests4={};this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests5=c('MercuryDispatcher').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests7=new (c('MercuryServerSendMessageQueueOptions'))(function(z,aa){this.__handleUpdate(z,aa);}.bind(this),function(z){return this.$MercuryServerRequests8(z);}.bind(this),function(z){this.$MercuryServerRequests9(z);}.bind(this),function(z){return this.$MercuryServerRequests10(z);}.bind(this),c('MercuryServerRequestsConfig').sendMessageTimeout,c('MessagingConfig').SEND_CONNECTION_RETRIES);this.$MercuryServerRequests11();}w.getForFBID=function(y){return x.getForFBID(y);};w.get=function(){return x.get();};w.prototype.fetchThreadlistInfo=function(y,z){var aa=arguments.length<=2||arguments[2]===undefined?c('MessagingTag').INBOX:arguments[2],ba=arguments[3],ca=arguments.length<=4||arguments[4]===undefined?k:arguments[4],da=ba?c('MercuryServerDispatcher').IMMEDIATE:null,ea={client:ca};ea[aa]={offset:y,limit:z,filter:ba};this.__sendRequest('/ajax/mercury/threadlist_info.php',ea,da);};w.prototype.fetchPinnedThreads=function(){this.__sendRequest('/mercury/pinned_threads/',{});};w.prototype.fetchUnseenThreadIDs=function(){var y=arguments.length<=0||arguments[0]===undefined?c('MessagingTag').INBOX:arguments[0],z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.fetchThreadlistInfo(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,c('MercuryThreadlistConstants').JEWEL_THREAD_COUNT,y,null,z);};w.prototype.fetchUnreadThreadIDs=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[y],client:z});};w.prototype.fetchThreadData=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];c('MercuryAssert').allThreadID(y);var aa={threads:{},client:z},ba=[],ca=[];y.forEach(function(ea){if(this.$MercuryServerRequests3[ea])return;this.$MercuryServerRequests3[ea]=true;var fa=this.__threadIDMap.getServerIDFromClientIDNow(ea),ga=c('MercuryIDs').tokenize(ea);if(ga.type=='user'){ba.push(ga.value);aa.threads.user_ids=ba;}else if(ga.type=='thread'){if(fa){ca.push(fa);}else ca.push(ga.value);aa.threads.thread_fbids=ca;}else if(ga.type=='root'){if(fa){ca.push(fa);aa.threads.thread_fbids=ca;}}else if(ga.type!='pending')throw new Error('Unknown thread type',ga);}.bind(this));this.$MercuryServerRequests5.inform('fetch-thread-data',aa);for(var da in aa.threads){this.__sendRequest('/ajax/mercury/thread_info.php',aa);break;}};w.prototype.ensureThreadIsFetched=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!this.__threadIDMap.getClientIDFromServerIDNow(y)&&!this.$MercuryServerRequests3[y]){this.$MercuryServerRequests3[y]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[y]},client:z});}};w.prototype.fetchThreadMessages=function(y,z,aa,ba,ca){var da=arguments.length<=5||arguments[5]===undefined?k:arguments[5];c('MercuryAssert').isThreadID(y);var ea=void 0,fa=void 0,ga=c('MercuryIDs').tokenize(y),ha=this.__threadIDMap.getServerIDFromClientIDNow(y),ia=false;if(ha){ea=ha;fa=ga.type=='user'?'user_ids':'thread_fbids';}else{ea=ga.value;switch(ga.type){case 'user':fa='user_ids';ia=true;break;case 'thread':fa='thread_fbids';break;}}var ja={messages:{},threads:{},client:da};if(fa){ja.messages[fa]={};ja.messages[fa][ea]={offset:z,timestamp:ba,limit:aa};if(ia)ja.threads[fa]=[ea];this.__sendRequest('/ajax/mercury/thread_info.php',ja,ca);}else this.__threadIDMap.getServerIDFromClientID(y,function(ka){ja.messages.thread_fbids={};ja.messages.thread_fbids[ka]={offset:z,timestamp:ba,limit:aa};this.__sendRequest('/ajax/mercury/thread_info.php',ja,ca);}.bind(this));};w.prototype.handleThreadInfoError=function(y){var z=y.getData(),aa=[];if(z.messages){for(var ba in z.messages.thread_fbids){var ca=this.__threadIDMap.getClientIDFromServerIDNow(ba);if(ca)aa.push(this.$MercuryServerRequests12(ca));}for(var da in z.messages.user_ids)aa.push(this.$MercuryServerRequests12('user:'+da));for(var ea in z.messages.group_ids)aa.push(this.$MercuryServerRequests12('group:'+ea));}if(aa.length)this.$MercuryServerRequests5.handleUpdate({actions:aa,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});if(z.threads&&(z.threads.user_ids||z.threads.group_ids||z.threads.thread_ids)){var fa=5,ga=true;if(!z.retry_count){z.retry_count=0;if(z.messages)delete z.messages;}else if(z.retry_count>=fa){ga=false;(z.threads.thread_ids||[]).forEach(function(ia){if(ia in this.$MercuryServerRequests3)delete this.$MercuryServerRequests3[ia];}.bind(this));}if(ga){var ha=Math.pow(2,z.retry_count)*1000;c('setTimeoutAcrossTransitions')(function(){j.log('retry_thread','{}');this.__sendRequest('/ajax/mercury/thread_info.php',z);}.bind(this),ha);z.retry_count++;}}};w.prototype.markFolderAsRead=function(y){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:y});var z=[{action_type:c('MercuryGlobalActionType').MARK_ALL_READ,folder:y}];this.$MercuryServerRequests5.handleUpdate({global_actions:z,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS});};w.prototype.changeThreadReadStatus=function(y,z,aa,ba,ca,da,ea){var fa;c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(ga){var ha={ids:(fa={},fa[ga]=z,fa),source:aa,watermarkTimestamp:ba,titanOriginatedThreadId:ca,shouldSendReadReceipt:da,commerce_last_message_type:ea};this.__sendRequest('/ajax/mercury/change_read_status.php',ha);}.bind(this));};w.prototype.changeThreadArchivedStatus=function(y,z,aa){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(ba){var ca={ids:{},source:aa};ca.ids[ba]=z;this.__sendRequest('/ajax/mercury/change_archived_status.php',ca);}.bind(this));};w.prototype.changeThreadFolder=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){var ba={};ba[z]=[aa];this.__sendRequest('/ajax/mercury/move_thread.php',ba);}.bind(this));};w.prototype.changeMutingOnThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:aa,mute_settings:z,payload_source:k});}.bind(this));};w.prototype.markThreadSpam=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:aa,source:z});}.bind(this));};w.prototype.unmarkThreadSpam=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:aa,source:z});}.bind(this));};w.prototype.deleteThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){var ba={ids:[aa],source:z};this.__sendRequest('/ajax/mercury/delete_thread.php',ba);}.bind(this));};w.prototype.unpinThread=function(y){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(z){this.__sendRequest('/mercury/unpin_thread/',{id:z});}.bind(this));};w.prototype.deleteMessages=function(y,z){c('MercuryMessageIDs').getServerIDs(z||[],function(aa){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:aa});}.bind(this));};w.prototype.sendDeliveryReceipts=function(y,z){c('MercuryMessageIDs').getServerIDs(y||[],function(aa){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:aa,thread_ids:z});}.bind(this));};w.prototype.sendNewMessage=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!y.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','missing_otid_on_send');if(y.client_state&&y.client_state!==c('MercuryMessageClientState').SEND_TO_SERVER)return;var aa=c('MercuryIDs').tokenize(y.thread_id),ba=aa.type,ca=babelHelpers['extends']({},y);ca.thread_id=null;if(ba=='user'){ca.other_user_fbid=aa.value;this.$MercuryServerRequests13(ca,z);}else if(ba=='thread'){ca.thread_fbid=aa.value;this.$MercuryServerRequests13(ca,z);}else if(ba=='root'&&aa.value==ca.offline_threading_id){ca.client_thread_id=y.thread_id;this.$MercuryServerRequests13(ca,z);}else{!c('MercuryIDs').isLocalThread(y.thread_id)?i(0):void 0;this.__threadIDMap.getServerIDFromClientID(y.thread_id,function(da){ca.thread_fbid=da;this.$MercuryServerRequests13(ca,z);}.bind(this));}};w.prototype.$MercuryServerRequests13=function(y,z){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this.$MercuryServerRequests4[y.message_id]=Date.now();c('MercuryServerSendMessageQueueRouter').getForFBID(this.$MercuryServerRequests1).enqueue(y.other_user_fbid||y.thread_fbid||y.client_thread_id,this.$MercuryServerRequests7,z,y);};w.prototype.markSeen=function(){var y=this.$MercuryServerRequests2;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:y});};w.prototype.$MercuryServerRequests14=function(y,z,aa,ba){j.debug('handle_send_message_error_common',JSON.stringify({reliability_error_status:aa,request_error_status:z}));var ca=y.getData(),da=ca.message_batch||[ca],ea=da.map(function(ga){var ha={action_type:c('MercuryActionType').SEND_MESSAGE,other_user_fbid:ga.other_user_fbid,thread_fbid:ga.thread_fbid,client_message_id:ga.message_id,message_id:ga.message_id,client_thread_id:ga.client_thread_id,status:z,error_data:ba};return ha;});ea.forEach(function(ga){if(ga.action_type===c('MercuryActionType').SEND_MESSAGE&&ga.status===c('MercuryActionStatus').ERROR)this.__logMercurySendError(ga);},this);var fa={actions:ea,payload_source:c('MercuryPayloadSource').CLIENT_HANDLE_ERROR};this.$MercuryServerRequests6.handleUpdate(fa);};w.prototype.handleSendMessageError=function(y){var z=y.getPayload(),aa=null,ba=null;if(z&&z.error_payload){aa=c('MercuryActionStatus').UNCONFIRMED;ba='send_error';}else{aa=c('MercuryActionStatus').ERROR;ba='request_error'+n(y);}var ca=y.error;if(ca===1404102)c('AsyncResponse').verboseErrorHandler(y);var da=/<.*>/.test(y.getErrorDescription())?y.getErrorSummary():y.getErrorDescription();this.$MercuryServerRequests14(y.getRequest(),aa,ba,{type:c('MercuryErrorType').SERVER,code:y.getError(),description:da,is_transient:y.isTransient()});};w.prototype.handleSendMessageTransportError=function(y){this.$MercuryServerRequests14(y.getRequest(),c('MercuryActionStatus').ERROR,'transport_error'+n(y),{type:c('MercuryErrorType').TRANSPORT,code:y.getError(),is_transient:true});};w.prototype.handleSendMessageTimeout=function(y){this.$MercuryServerRequests14(y,c('MercuryActionStatus').ERROR,'transport_timeout',{type:c('MercuryErrorType').TIMEOUT,is_transient:true});};w.prototype.getLastActionTimestamp=function(){return this.$MercuryServerRequests2;};w.prototype.__logMercurySendError=function(y){c('MercurySendErrorLogger').log(y);};w.prototype.updateLastActionTimestamp=function(y){var z=Date.now()-1000*60*60*24;if(y&&y>z)this.$MercuryServerRequests2=Math.max(this.$MercuryServerRequests2,y);};w.prototype.markThreadFetched=function(y){delete this.$MercuryServerRequests3[y];};w.prototype.$MercuryServerRequests12=function(y){return {action_type:c('MercuryActionType').LOG_MESSAGE,thread_id:y,message_id:y,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:c('MercurySourceType').UNKNOWN,log_message_body:'',log_message_type:c('MercuryLogMessageType').SERVER_ERROR,log_message_data:{}};};w.prototype.__getForAsyncRequest=function(y){var z=y.getData(),aa=z.request_user_id?z.request_user_id:c('CurrentUser').getID();return w.getForFBID(aa);};w.prototype.__handleUpdate=function(y,z){this.__getForAsyncRequest(z).$MercuryServerRequests6.handleUpdate(y);};w.prototype.$MercuryServerRequests15=function(y){var z=this.__getForAsyncRequest(y);z.handleThreadInfoError(y);};w.prototype.$MercuryServerRequests8=function(y){var z=this.__getForAsyncRequest(y.getRequest());z.handleSendMessageError(y);};w.prototype.$MercuryServerRequests9=function(y){var z=this.__getForAsyncRequest(y.getRequest());z.handleSendMessageTransportError(y);};w.prototype.$MercuryServerRequests10=function(y){var z=this.__getForAsyncRequest(y);z.handleSendMessageTimeout(y);};w.prototype.$MercuryServerRequests11=function(){var y=null;if(c('MercuryServerRequestsConfig').msgrRegion)y={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var z={'/ajax/mercury/thread_info.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,customHeader:y,batch_function:o,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this),error_handler:function(aa){return (this.$MercuryServerRequests15(aa.getRequest()));}.bind(this),timeout_handler:function(aa){return this.$MercuryServerRequests15(aa);}.bind(this),timeout:m},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:r,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:y,batch_function:q,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:y,batch_function:p,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/chat/settings.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y},'/ajax/mercury/change_archived_status.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:t,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:v,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:y,batch_function:u,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/mercury/pinned_threads/':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)},'/mercury/unpin_thread/':{request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:y,handler:function(aa,ba){return this.__handleUpdate(aa,ba);}.bind(this)}};c('MercuryServerDispatcher').registerEndpoints(z);};w.prototype.__sendRequest=function(y,z,aa){c('MercuryServerDispatcher').trySend(y,z,aa,this.$MercuryServerRequests1);};w.prototype.__getFBID=function(){return this.$MercuryServerRequests1;};var x=new (c('MercurySingletonProvider'))(w);f.exports=w;},null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercuryThreadIDMap1=j;this.$MercuryThreadIDMap2=new (c('KeyedCallbackManager'))();this.$MercuryThreadIDMap3=new (c('KeyedCallbackManager'))();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.setServerIDToClientID=function(j,k){var l=this.getClientIDFromServerIDNow(j);if(l){l!==k;return;}this.forceSetServerIDToClientID(j,k);};h.prototype.forceSetServerIDToClientID=function(j,k){this.$MercuryThreadIDMap2.setResource(j,k);this.$MercuryThreadIDMap3.setResource(k,j);};h.prototype.setDeprecatedServerIDToClientID=function(j,k){if(j)this.$MercuryThreadIDMap2.setResource(j,k);};h.prototype.getClientIDFromServerIDNow=function(j){return this.$MercuryThreadIDMap2.getResource(j);};h.prototype.getClientIDFromServerID=function(j,k){this.$MercuryThreadIDMap2.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(l){l.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(j);}.bind(this));};h.prototype.getServerIDFromClientIDNow=function(j){return this.$MercuryThreadIDMap3.getResource(j);};h.prototype.getServerIDFromClientID=function(j,k){c('MercuryAssert').isThreadID(j);var l=this.$MercuryThreadIDMap3.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(m){var n=this.$MercuryThreadIDMap3.getUnavailableResources(l),o=c('MercuryIDs').tokenize(j);if(n.length&&o.type!='root')m.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(n);}.bind(this));};h.prototype.hasClientIDForServerID=function(j){return !!this.getClientIDFromServerIDNow(j);};h.prototype.convertThreadIDIfAvailable=function(j){var k=this.getClientIDFromServerIDNow(j);return k||j;};h.prototype.canLinkExternally=function(j){c('MercuryAssert').isThreadID(j);var k=c('MercuryIDs').tokenize(j);return k.type=='user'||!!this.getServerIDFromClientIDNow(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderFilteredContent:function(j){if(j.is_filtered_content_bh)return h._("This message was removed because it contains blocked or harmful links.");if(j.is_filtered_content_account)return h._("This message has been temporarily removed because the sender's account requires verification.");if(j.is_filtered_content_quasar)return h._("This message was removed because it contains blocked or harmful content.");if(j.is_filtered_content_invalid_app)return h._("This message was removed because the app it's being sent from is blocked from sending messages.");return h._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive.");}};f.exports=i;},null);
__d('MercuryFolders',['MercuryFoldersConfig','MessagingTag'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[c('MessagingTag').INBOX,c('MessagingTag').PENDING,c('MessagingTag').OTHER,c('MessagingTag').ACTION_ARCHIVED],i={getSupportedFolders:function(){return h.filter(function(j){if(j===c('MessagingTag').PENDING){return !c('MercuryFoldersConfig').hide_message_filtered;}else if(j===c('MessagingTag').OTHER)return !c('MercuryFoldersConfig').hide_message_requests;return true;}).concat();},getFromMeta:function(j){var k=j.folder;if(j.is_archived)k=c('MessagingTag').ACTION_ARCHIVED;return k;}};f.exports=i;},null);
__d('MercuryGiftSnippetRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderText:function(j,k){return j?h._("You sent a valentine."):h._("{name} sent a valentine.",[h.param('name',k)]);}};f.exports=i;},null);
__d('ImageSourceType',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};f.exports=h;},null);
__d('ImageSourceRequest',['CurrentUser','ImageSourceType','KeyedCallbackManager','PhotoResizeModeConst','MercuryServerDispatcher','arrayContains'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}h.prototype.setFBID=function(l){'use strict';this._request.fbid=l;return this;};h.prototype.setType=function(l){'use strict';if(!c('arrayContains')([c('ImageSourceType').PROFILE_PICTURE,c('ImageSourceType').IMAGE],l))throw new TypeError('ImageSourceRequest.setType: invalid type '+l);this._request.type=l;return this;};h.prototype.setDimensions=function(l,m){'use strict';this._request.width=l;this._request.height=m;return this;};h.prototype.setResizeMode=function(l){'use strict';if(!c('arrayContains')([c('PhotoResizeModeConst').COVER,c('PhotoResizeModeConst').CONTAIN],l))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+l);this._request.resize_mode=l;return this;};h.prototype.setCallback=function(l){'use strict';this._callback=l;return this;};h.prototype.send=function(){'use strict';if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var l=j(),m=k(this._request);l.executeOrEnqueue(m,this._callback);if(l.getUnavailableResourcesFromRequest(m).length===1){c('MercuryServerDispatcher').trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var i=null;function j(){if(i)return i;var l=new (c('KeyedCallbackManager'))();i=l;c('MercuryServerDispatcher').registerEndpoints({'/ajax/image_source.php':{request_user_id:c('CurrentUser').getID(),mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,batch_function:function(m,n){var o;(o=m.requests).push.apply(o,n.requests);return m;},handler:function(m,n){var o=n.getData().requests;for(var p=0;p<o.length;++p)l.setResource(k(o[p]),m[p]);}}});return l;}function k(l){return [l.fbid,l.type,l.width,l.height,l.resize_mode].join('|');}f.exports=h;},null);
__d('MercuryParticipantFetcher',['LogHistory','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','Set','ShortProfiles','setImmediate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('short_profiles');function i(k){this.$MercuryParticipantFetcher4=c('MercuryServerPayloadPreprocessor').getForFBID(k);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new (c('Set'))();this.$MercuryParticipantFetcher3=new (c('Set'))();}i.prototype.fetch=function(k){this.$MercuryParticipantFetcher5(k);this.$MercuryParticipantFetcher6();};i.prototype.fetchMulti=function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher5(l);}.bind(this));this.$MercuryParticipantFetcher6();};i.prototype.$MercuryParticipantFetcher5=function(k){if(!this.$MercuryParticipantFetcher3.has(k))this.$MercuryParticipantFetcher2.add(k);};i.prototype.$MercuryParticipantFetcher6=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;c('setImmediate')(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(k){return this.$MercuryParticipantFetcher3.add(k);}.bind(this));this.$MercuryParticipantFetcher7(this.$MercuryParticipantFetcher2,function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher3['delete'](l.id);}.bind(this));this.$MercuryParticipantFetcher8(k);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};i.prototype.$MercuryParticipantFetcher7=function(k,l){var m=[];k.forEach(function(n){var o=c('MercuryIDs').tokenize(n),p=o.type,q=o.value;p==='fbid'&&m.push(q);});if(m.length>0){c('ShortProfiles').getMulti(m,function(n){var o=[];for(var p in n)o.push(j(n[p],p));l(o);if(o.length!==m.length)h.error('server_fetch_participant_count_error',JSON.stringify({expectedIDs:m,receivedIDs:Object.keys(n)}));});h.debug('client_fetch_participants',JSON.stringify({userIDs:m}));}};i.prototype.$MercuryParticipantFetcher8=function(k){this.$MercuryParticipantFetcher4.handleUpdate({participants:k,from_client:false,payload_source:c('MercuryPayloadSource').SERVER_FETCH_PARTICIPANTS});};function j(k,l){var m=babelHelpers['extends']({gender:k.gender,fbid:k.id||l,href:k.uri,id:c('MercuryIDs').getParticipantIDFromUserID(k.id||l),image_src:k.thumbSrc,name:k.name,short_name:k.firstName,employee:k.employee,is_employee_away:k.is_employee_away,type:k.type,vanity:k.vanity,is_friend:k.is_friend,is_messenger_user:k.is_messenger_user,social_snippets:k.social_snippets,is_anonymous_crisis_support:k.isAnonymousCrisisSupport},{});if(k.officeStatus){m.officeStatus=k.officeStatus;m.officeStatusStartDate=k.officeStatusStartDate;m.officeStatusEndDate=k.officeStatusEndDate;m.officeStatusComment=k.officeStatusComment;m.officeStatusLocation=k.officeStatusLocation;}if(k.timezone||k.timezone===0)m.timezone=k.timezone;if(k.personal_id)m.personal_id=k.personal_id;if(k.work_id)m.work_id=k.work_id;return m;}f.exports=i;},null);
__d('MercuryVanityIDMap',['Map','MercuryAssert'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new (c('Map'))(),i=new (c('Map'))(),j={getID:function(k){return h.get(k.toLowerCase());},getVanity:function(k){return i.get(k);},hasID:function(k){return i.has(k);},hasVanity:function(k){return h.has(k.toLowerCase());},set:function(k,l){c('MercuryAssert').isParticipantID(l);var m=k.toLowerCase();h.set(m,l);i.set(l,m);}};f.exports=j;},null);
__d('MercuryParticipants',['fbt','CurrentUser','EventEmitter','ImageSourceRequest','ImageSourceType','ImmutableObject','KeyedCallbackManager','MercuryAssert','MercuryIDs','MercuryParticipantFetcher','MercuryParticipantTypes','MercuryParticipantsConstants','MercuryDispatcher','MercuryVanityIDMap','PhotoResizeModeConst','Set','createObjectFrom'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='change';function j(l){this.$MercuryParticipants1=l;this.$MercuryParticipants2=new (c('EventEmitter'))();this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();this.$MercuryParticipants4=new (c('MercuryParticipantFetcher'))(this.$MercuryParticipants1);this.$MercuryParticipants5=c('MercuryDispatcher').getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe('update-participants',function(m,n){if(n.participants&&n.participants.length>0)this.$MercuryParticipants6(n.participants);}.bind(this));this.$MercuryParticipants5.subscribe('invalidate-global-state',function(){this.$MercuryParticipants7();}.bind(this));}j.prototype.addListener=function(l,m){return this.$MercuryParticipants2.addListener(l,m);};j.prototype.getIDFromVanityOrFBID=function(l){if(!l)return null;if(c('MercuryVanityIDMap').hasVanity(l))return c('MercuryVanityIDMap').getID(l);if(/^\d+$/.test(l))return c('MercuryIDs').getParticipantIDFromUserID(l);};j.prototype.getNow=function(l){return this.$MercuryParticipants8(l);};j.prototype.getOrFetch=function(l){var m=this.$MercuryParticipants8(l);if(!m)this.$MercuryParticipants4.fetch(l);return m;};j.prototype.get=function(l,m){c('MercuryAssert').isParticipantID(l);return this.$MercuryParticipants9([l],function(n){m(n[l]);});};j.prototype.getMulti=function(l,m){return this.$MercuryParticipants9(l,m);};j.prototype.getBigImageMulti=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=c('MercuryParticipantsConstants').BIG_IMAGE_SIZE;return this.$MercuryParticipants9(l,function(o){var p={},q=0,r=new (c('Set'))(),s=function(w,x){q++;p[w]=x;if(q===l.length){m(p);if(r.size>0)this.$MercuryParticipants10(r);}}.bind(this),t=function(w,x){this.$MercuryParticipants3.setResource(w,c('ImmutableObject').set(this.$MercuryParticipants3.getResource(w),{big_image_src:x.uri}));r.add(w);s(w,x.uri);}.bind(this);for(var u in o){var v=o[u];if(!v.big_image_src){new (c('ImageSourceRequest'))().setFBID(c('MercuryIDs').getUserIDFromParticipantID(u)).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(n,n).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(t.bind(null,u)).send();}else s(v.id,v.big_image_src);}}.bind(this));};j.prototype.getOrderedBigImageMulti=function(l,m){return this.getBigImageMulti(l,function(n){m(l.map(function(o){return n[o];}));});};j.prototype.$MercuryParticipants9=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=this.$MercuryParticipants3.executeOrEnqueue(l,m),o=this.$MercuryParticipants3.getUnavailableResources(n).filter(function(p){var q=c('MercuryIDs').tokenize(p),r=q.type,s=q.value;if(r==='email'){this.$MercuryParticipants11(p,s);return false;}if(r==='name'){this.$MercuryParticipants12(p,s);return false;}return true;}.bind(this));this.$MercuryParticipants4.fetchMulti(o);return this.$MercuryParticipants13(n);};j.prototype.$MercuryParticipants8=function(l){var m=this.$MercuryParticipants3.getResource(l);if(!m){var n=c('MercuryIDs').tokenize(l),o=n.type,p=n.value;if(o==='email')m=this.$MercuryParticipants11(l,p);if(o==='name')m=this.$MercuryParticipants12(l,p);}return m;};j.prototype.$MercuryParticipants11=function(l,m){var n=new (c('ImmutableObject'))(k(l,m));this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants12=function(l,m){var n=new (c('ImmutableObject'))({gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false});this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants10=function(l){this.$MercuryParticipants2.emit(i,l);};j.prototype.$MercuryParticipants6=function(l){var m=l.map(function(n){return n.id;});l=l.map(function(n){if(n.vanity)c('MercuryVanityIDMap').set(n.vanity,n.id);var o=this.$MercuryParticipants3.getResource(n.id);return o?c('ImmutableObject').set(o,n):new (c('ImmutableObject'))(this.$MercuryParticipants14(n));}.bind(this));this.$MercuryParticipants3.addResourcesAndExecute(c('createObjectFrom')(m,l));this.$MercuryParticipants10(new (c('Set'))(m));};j.prototype.$MercuryParticipants14=function(l){var m=l.type===c('MercuryParticipantTypes').USER||l.type===c('MercuryParticipantTypes').FRIEND;if(!m)return l;if(!l.name&&!l.href&&!l.vanity){var n=h._("Facebook User");l.name=n;l.short_name=n;}return l;};j.prototype.$MercuryParticipants13=function(l){return {remove:function(){this.$MercuryParticipants3.unsubscribe(l);}.bind(this)};};j.prototype.$MercuryParticipants7=function(){this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();};function k(l,m){return {gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false,fbid:undefined,is_business_enabled:undefined,is_messenger_platform_bot:undefined,is_employee_away:undefined,is_friend:undefined,is_messenger_user:undefined,is_verified:undefined,social_snippets:undefined,type:undefined,vanity:undefined,timezone:undefined,personal_id:undefined,work_id:undefined};}f.exports=new j(c('CurrentUser').getID());},null);
__d('MercurySyncDeltaTypes',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={AdminAddedToGroupThread:'AdminAddedToGroupThread',AdminRemovedFromGroupThread:'AdminRemovedFromGroupThread',AdminTextMessage:'AdminTextMessage',DeliveryReceipt:'DeliveryReceipt',ForcedFetch:'ForcedFetch',MarkRead:'MarkRead',MarkUnread:'MarkUnread',MessageDelete:'MessageDelete',NewMessage:'NewMessage',PagesManagerEvent:'PagesManagerEvent',ParticipantLeftGroupThread:'ParticipantLeftGroupThread',ParticipantsAddedToGroupThread:'ParticipantsAddedToGroupThread',ReadReceipt:'ReadReceipt',ReplaceMessage:'ReplaceMessage',RTCEventLog:'RTCEventLog',ThreadAction:'ThreadAction',ThreadDelete:'ThreadDelete',ThreadMuteSettings:'ThreadMuteSettings',ThreadName:'ThreadName',JoinableMode:'JoinableMode',ApprovalMode:'ApprovalMode',ApprovalQueue:'ApprovalQueue'};f.exports=h;},null);
__d('MercurySyncFakeDFFSender',['Arbiter','ChannelConstants','MercurySingletonProvider','MercurySyncDeltaTypes'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF);i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncFakeDFFSender1=k;}i.prototype.sendGlobalDFF=function(){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch},queue:this.$MercurySyncFakeDFFSender1}});};i.prototype.sendThreadDFF=function(k,l){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l}},queue:this.$MercurySyncFakeDFFSender1}});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;},null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={canReply:function(j){return !!(j.is_subscribed&&(j.can_reply===undefined||j.can_reply)&&!j.has_email_participant&&!j.read_only&&(j.recipients_loadable||j.recipients_loadable===undefined));},getMuteSetting:function(j){return (j.mute_settings&&j.mute_settings[i(c('CurrentUser').getID())]);},isEmptyLocalThread:function(j){return (c('MercuryIDs').tokenize(j.thread_id).type==='root'&&!j.timestamp);},isMuted:function(j){return h.getMuteSetting(j)!==undefined;},isNewEmptyLocalThread:function(j){return !!(h.isEmptyLocalThread(j)&&j.participants&&j.participants.length===0);},showComposer:function(j){return !!(j.is_subscribed&&(j.composer_enabled===undefined||j.composer_enabled)&&!j.has_email_participant&&!j.read_only&&(j.recipients_loadable||j.recipients_loadable===undefined));}};function i(j){return j+'@facebook.com';}f.exports=h;},null);
__d('MessagingGiftWrapConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='gift_wrap',i='gift_unwrapped',j='valentines2016';f.exports={TAG_PREFIX:h,UNWRAPPED_TAG:i,VALENTINES_GIFT:j};},null);
__d('MessagingGiftWrapChecker',['MercuryConfig','MercuryTagHelper','MessagingGiftWrapConstants'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={shouldRenderWithGiftWrap:function(k){return !!(c('MercuryConfig').GiftWrapViewerGK&&k.tags&&i(k.tags)&&!j(k.tags));}};function i(k){return c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').TAG_PREFIX)===c('MessagingGiftWrapConstants').VALENTINES_GIFT;}function j(k){return !!c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').UNWRAPPED_TAG);}f.exports=h;},null);
__d('MercuryThreads',['invariant','EventEmitter','MercuryDisplayTimeFilterMessageRenderer','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryAPIArgsSource','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryFolders','MercuryGiftSnippetRenderer','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryLoggingHelper','MercuryParticipants','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MercuryThreadInfo','MercuryThreadInformer','MessagingGenericAdminTextType','MessagingGiftWrapChecker','MessagingTag','Set','emptyFunction','ifRequired','requireWeak','setImmediate'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_threads');function k(m){this.$MercuryThreads1=m;this.$MercuryThreads2=c('MercuryServerRequests').getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=c('MercuryThreadInformer').getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=c('MercuryDispatcher').getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=c('MercurySyncFakeDFFSender').getForFBID(this.$MercuryThreads1);this.$MercuryThreads7=false;this.$MercuryThreads8=new (c('KeyedCallbackManager'))();this.$MercuryThreads9=new (c('Set'))();this.$MercuryThreads10=false;this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12=new (c('Set'))();this.$MercuryThreads13();}k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};k.prototype.getThreadMetaNow=function(m){c('MercuryAssert').isThreadID(m);return this.$MercuryThreads8.getResource(m);};k.prototype.getOrFetch=function(m){var n=this.getThreadMetaNow(m);if(!n&&!this.$MercuryThreads12.has(m))this.$MercuryThreads11.add(m);if(this.$MercuryThreads11.size>0&&!this.$MercuryThreads10)this.$MercuryThreads14();return n;};k.prototype.$MercuryThreads14=function(){if(this.$MercuryThreads10)return;this.$MercuryThreads10=true;c('setImmediate')(function(){this.$MercuryThreads10=false;this.$MercuryThreads11.forEach(function(m){return this.$MercuryThreads12.add(m);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads11),function(m){for(var n in m)m.hasOwnProperty(n)&&this.$MercuryThreads12['delete'](n);}.bind(this));this.$MercuryThreads11.clear();}.bind(this));};k.prototype.getThreadMeta=function(m,n,o){return this.getMultiThreadMeta([m],function(p){return n(p[m]);},o);};k.prototype.getMultiThreadMeta=function(m,n,o){c('MercuryAssert').allThreadID(m);var p=this.$MercuryThreads8.executeOrEnqueue(m,n),q=this.$MercuryThreads8.getUnavailableResources(p);if(q.length){var r=[];for(var s=0;s<q.length;s++){var t=q[s],u=c('MercuryIDs').tokenize(t),v=u.type,w=u.value;if(v=='user'){var x=c('MercuryIDs').getParticipantIDFromUserID(w);this.createNewLocalThread(t,x===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,x]);}r.push(t);}if(r.length)this.$MercuryThreads2.fetchThreadData(r,o);}return p;};k.addListener=function(m,n){return i.addListener(m,n);};k.prototype.unsubscribe=function(m){this.$MercuryThreads8.unsubscribe(m);};k.prototype.getCanonicalThreadToParticipant=function(m,n,o,p){var q=c('MercuryIDs').getThreadIDFromParticipantID(m);!!!q?h(0):void 0;var r=this.$MercuryThreads8.getResource(q);if(typeof r=='undefined'){r=this.createNewLocalThread(q,this.$MercuryThreads4===m?[this.$MercuryThreads4]:[this.$MercuryThreads4,m],n);!p&&this.$MercuryThreads2.fetchThreadData([q],o);}return r;};k.prototype.createNewLocalThread=function(m,n,o){var p=this.$MercuryThreads8.getResource(m);if(!p){var q=c('MercuryIDs').tokenize(m),r=q.type,s=q.value;p=new (c('ImmutableObject'))({thread_id:m,participants:Array.from(n),name:'',snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:o?o:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,other_user_fbid:r==='user'?s:null,is_canonical_user:r=='user',is_canonical:this.$MercuryThreads15(n),is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});this.$MercuryThreads8.setResource(m,p);}return p;};k.prototype.isEmptyLocalThread=function(m){var n=this.$MercuryThreads8.getResource(m);if(!n)return false;return c('MercuryThreadInfo').isEmptyLocalThread(n);};k.prototype.isNewEmptyLocalThread=function(m){var n=this.$MercuryThreads8.getResource(m);if(!n)return false;return c('MercuryThreadInfo').isNewEmptyLocalThread(n);};k.prototype.$MercuryThreads16=function(m,n){if(!m||!m.length)return;var o=new (c('Map'))(),p=new (c('Map'))(),q=new (c('Map'))(),r=[];for(var s=0;s<m.length;s++){var t=m[s];if(t.is_forward)continue;var u=t.action_type;if(u==c('MercuryActionType').LOG_MESSAGE&&t.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)continue;var v=!!(t.sync_id||t.is_from_iris),w=t.thread_id;c('MercuryAssert').isThreadID(w);var x=this.$MercuryThreads8.getResource(w);if(!x&&!v&&u==c('MercuryActionType').USER_GENERATED_MESSAGE){x=this.$MercuryThreads17(t);if(x.participants){this.$MercuryThreads8.setResource(w,x);}else j.debug('missing_local_participants',JSON.stringify(t));}if(!x)continue;if(u==c('MercuryActionType').LOG_MESSAGE||u==c('MercuryActionType').USER_GENERATED_MESSAGE)v=!n;if(x.server_timestamp&&t.timestamp<=x.server_timestamp&&v)continue;if(!q.has(w))q.set(w,babelHelpers['extends']({},x));this.$MercuryThreads18(q.get(w),t,n);if(u==c('MercuryActionType').USER_GENERATED_MESSAGE)o.set(w,t);if(u==c('MercuryActionType').USER_GENERATED_MESSAGE||u==c('MercuryActionType').LOG_MESSAGE)if(t&&t.timestamp&&(!p.has(w)||t.timestamp>p.get(w).timestamp))p.set(w,t);}q.forEach(function(y,z){var aa=p.get(z),ba=o.get(z);if(ba){this.$MercuryThreads19(y,ba);}else if(aa&&aa.log_message_body){var ca=babelHelpers['extends']({},aa,{body:aa.log_message_body});this.$MercuryThreads19(y,ca);}var da=y.timestamp;if(aa){if(aa.timestamp>da)Object.assign(y,{timestamp_absolute:aa.timestamp_absolute,timestamp_relative:aa.timestamp_relative,timestamp:aa.timestamp});var ea=y.server_timestamp;if(!n&&aa.timestamp>ea)y.server_timestamp=aa.timestamp;}var fa=new (c('ImmutableObject'))(y);this.$MercuryThreads8.setResource(z,fa);r.push(c('MercuryLoggingHelper').obfuscateThread(fa));}.bind(this),this);r.length&&this.$MercuryThreads7&&j.debug('threads_updated',JSON.stringify({threads:r}));};k.prototype.$MercuryThreads18=function(m,n,o){var p=n.action_type;if(p==c('MercuryActionType').USER_GENERATED_MESSAGE||p==c('MercuryActionType').LOG_MESSAGE){n.is_unread&&m.unread_count++;m.message_count++;m.is_archived=false;}switch(p){case c('MercuryActionType').DELETE_THREAD:m.message_count=0;this.$MercuryThreads20(n.thread_id);break;case c('MercuryActionType').USER_GENERATED_MESSAGE:if(m.unread_count===0&&n.author===this.$MercuryThreads4&&n.timestamp>=m.last_read_timestamp)m.last_read_timestamp=n.timestamp;if(n.offline_threading_id!==n.message_id)m.last_message_timestamp=n.timestamp;this.$MercuryThreads21(m,n.author);break;case c('MercuryActionType').SEND_MESSAGE:var q=n.log_message_type;if(q==c('MercuryLogMessageType').THREAD_IMAGE){m.image_src=n.log_message_data.image?n.log_message_data.image.preview_url:null;this.$MercuryThreads22(n.thread_id);}if(q!==c('MercuryLogMessageType').SUBSCRIBE&&q!==c('MercuryLogMessageType').UNSUBSCRIBE)m.snippet_attachments=n.attachments;break;case c('MercuryActionType').LOG_MESSAGE:var q=n.log_message_type;if(q==c('MercuryLogMessageType').SUBSCRIBE){this.$MercuryThreads23(m,n.log_message_data.added_participants);this.$MercuryThreads22(n.thread_id);}else if(q==c('MercuryLogMessageType').UNSUBSCRIBE){this.$MercuryThreads24(m,n.log_message_data.removed_participants);this.$MercuryThreads22(n.thread_id);}else if(q==c('MercuryLogMessageType').THREAD_IMAGE){if(!o)m.image_src=n.log_message_data.image?n.log_message_data.image.preview_url:null;}else if(q==c('MercuryLogMessageType').THREAD_NAME){if(m.name!==n.log_message_data.name)this.$MercuryThreads22(n.thread_id);m.name=n.log_message_data.name;}else if(q===c('MercuryLogMessageType').GENERIC_ADMIN_TEXT)this.$MercuryThreads25(m,n);break;case c('MercuryActionType').CHANGE_READ_STATUS:var r=this.$MercuryThreads26(m,n,n.mark_as_read);if(r)m.last_read_timestamp=m.last_message_timestamp;var s=!m.read_only&&m.folder===c('MessagingTag').INBOX;if(r&&o)this.$MercuryThreads2.changeThreadReadStatus(m.thread_id,n.mark_as_read,n.source,m.last_read_timestamp,m.titan_originated_thread_id,s,m.last_message_type);break;case c('MercuryActionType').CHANGE_ARCHIVED_STATUS:if(m.is_archived!=n.archived){m.is_archived=n.archived;this.$MercuryThreads22(n.thread_id);}break;case c('MercuryActionType').CHANGE_FOLDER:if(m.folder!=n.new_folder){m.folder=n.new_folder;this.$MercuryThreads22(n.thread_id);}break;case c('MercuryActionType').DELETE_MESSAGES:if(o){m.snippet='...';m.snippet_has_attachment=false;m.snippet_attachments=null;m.snippet_sender=null;this.$MercuryThreads22(n.thread_id);}else if(n.message_ids){m.message_count-=n.message_ids.length;c('ifRequired')('MercuryMessages',function(v){v=v.getForFBID(this.$MercuryThreads1);for(var w=n.message_ids,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var z;if(x){if(y>=w.length)break;z=w[y++];}else{y=w.next();if(y.done)break;z=y.value;}var aa=z,ba=v.getMessagesFromIDs([aa]),ca=ba[0];if(ca&&ca.timestamp>m.last_read_timestamp)m.unread_count=Math.max(0,m.unread_count-1);}this.$MercuryThreads22(n.thread_id);}.bind(this),c('emptyFunction'));}break;case c('MercuryActionType').UPDATE_SNIPPET:c('ifRequired')('MercuryMessages',function(v){v=v.getForFBID(this.$MercuryThreads1);var w=0,x=1,y=v.getThreadMessagesRangeNow(n.thread_id,w,x),z=y[0];if(z){m.snippet=z.body;m.snippet_has_attachment=z.has_attachment;m.snippet_attachments=z.attachments;m.snippet_sender=z.author;}else{m.snippet='...';m.snippet_has_attachment=false;m.snippet_attachments=null;m.snippet_sender=null;v.getThreadMessagesRange(n.thread_id,w,x,function(aa){if(aa.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:n.thread_id,action_type:c('MercuryActionType').UPDATE_SNIPPET,deleted_ids:n.deleted_ids}]});}.bind(this));}this.$MercuryThreads22(n.thread_id);}.bind(this),c('emptyFunction'));break;case c('MercuryActionType').UPDATE_BLOCKER_STATUS:m.can_reply=!!(!n.message_blocked&&(n.is_blocked_by_recipient===undefined||!n.is_blocked_by_recipient)&&m.is_subscribed&&!m.has_email_participant&&!m.read_only&&(m.recipients_loadable||m.recipients_loadable===undefined));this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').UPDATE_BLOCKEE_STATUS:m.can_reply=!!(!n.got_blocked&&m.is_subscribed&&!m.has_email_participant&&!m.read_only&&(m.recipients_loadable||m.recipients_loadable===undefined));this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').CHANGE_MUTE_SETTINGS:if(n.mute_settings!==undefined){var t=this.$MercuryThreads1+'@facebook.com';if(m.mute_settings){if(n.mute_settings){var u={};u[t]=n.mute_settings;m.mute_settings=babelHelpers['extends']({},m.mute_settings,u);}else{m.mute_settings=babelHelpers['extends']({},m.mute_settings);delete m.mute_settings[t];}this.$MercuryThreads22(m.thread_id);}}break;case c('MercuryActionType').ADD_PARTICIPANTS:this.$MercuryThreads23(m,n.participants);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').CHANGE_FLAG:this.$MercuryThreads27(m,n.mark_as_flag);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').MOVE_PENDING_TO_INBOX:this.$MercuryThreads28(m);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').UPDATE_CUSTOM_LIKE:m.custom_like_icon=n.custom_like;this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').ADD_GROUP_ADMINS:m.admin_ids=m.admin_ids.concat(n.added_admin_ids.filter(function(v){return m.admin_ids.indexOf(v)===-1;}));this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').REMOVE_GROUP_ADMINS:m.admin_ids=m.admin_ids.filter(function(v){return n.removed_admin_ids.indexOf(v)===-1;});this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').JOINABLE_MODE:m.joinable_mode=n.joinable_mode;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').APPROVAL_MODE:m.approval_mode=n.approval_mode;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').APPROVAL_QUEUE:if(n.added_id&&m.approval_queue_ids&&m.approval_queue_ids.indexOf(n.added_id)===-1)m.approval_queue_ids=m.approval_queue_ids.concat(n.added_id);if(n.removed_id&&m.approval_queue_ids)m.approval_queue_ids=m.approval_queue_ids.filter(function(v){return n.removed_id!==v;});this.$MercuryThreads22(n.thread_id);break;}};k.prototype.$MercuryThreads25=function(m,n){var o,p=this;if(n.log_message_data&&n.log_message_data.untypedData)(function(){var q=n.log_message_data.untypedData;switch(n.log_message_data.message_type){case c('MessagingGenericAdminTextType').THREAD_EPHEMERAL_SEND_MODE:var r=parseInt(q.ttl,10);if(r!==null&&m.ephemeral_ttl_mode!==r){m.ephemeral_ttl_mode=r;p.$MercuryThreads22(n.thread_id);}break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_NICKNAME:var s={};for(var t in m.custom_nickname){if(t==q.participant_id&&q.nickname.trim().length==0)continue;s[t]=m.custom_nickname[t];}if(q.nickname.trim().length>0)s[q.participant_id]=q.nickname;m.custom_nickname=s;p.$MercuryThreads22(n.thread_id);break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_ICON:c('requireWeak')('MercuryThreadActions',function(v){v.getForFBID(this.$MercuryThreads1).updateCustomLike(n.thread_id,q.thread_icon);}.bind(p));break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_THEME:var u=q.theme_color;if(u.length>0){m.custom_color='#'.concat(u.substring(2));}else m.custom_color=null;p.$MercuryThreads22(n.thread_id);break;}})();};k.prototype.$MercuryThreads17=function(m){var n=c('MercuryIDs').tokenize(m.thread_id),o=n.type,p=n.value,q=m.specific_to_list&&this.$MercuryThreads15(m.specific_to_list);return new (c('ImmutableObject'))({thread_id:m.thread_id,participants:m.specific_to_list,name:null,snippet:m.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:m.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:m.timestamp_absolute,timestamp_relative:m.timestamp_relative,timestamp:m.timestamp,other_user_fbid:o==='user'?p:null,is_canonical_user:o==='user',is_canonical:q,is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});};k.prototype.$MercuryThreads26=function(m,n,o){if(n.timestamp)this.$MercuryThreads29(m.thread_id,o,n.timestamp);if(!m||!m.thread_id)return false;if(!m.timestamp){this.$MercuryThreads9.add(m.thread_id);return false;}var p=!m.unread_count;if(o==p)return false;m.unread_count=o?0:1;this.$MercuryThreads22(m.thread_id);return true;};k.prototype.$MercuryThreads30=function(m){var n=this.$MercuryThreads8.getAllResources();for(var o in n)if(n.hasOwnProperty(o)){var p=n[o];if(p.folder==m){this.$MercuryThreads8.setResource(o,c('ImmutableObject').setProperty(p,'unread_count',0));this.$MercuryThreads22(o);}}};k.prototype.$MercuryThreads23=function(m,n){var o=new (c('Set'))(m.participants);m.participants=Array.from(m.participants);n.forEach(function(p){if(!o.has(p)){m.participants.push(p);if(p===this.$MercuryThreads4){m.is_subscribed=true;m.can_reply=true;m.composer_enabled=true;this.$MercuryThreads6.sendThreadDFF(undefined,m.thread_fbid);}}}.bind(this));};k.prototype.$MercuryThreads24=function(m,n){var o=new (c('Set'))(n);m.participants=m.participants.filter(function(p){return !o.has(p);});m.admin_ids=m.admin_ids.filter(function(p){return !o.has(p);});if(o.has(this.$MercuryThreads4))m.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([m.thread_id]);};k.prototype.$MercuryThreads21=function(m,n){if(!m.participants){var o=JSON.stringify({thread_info:m,participant:n});j.debug('missing_participants',o);return;}var p=m.participants.indexOf(n);if(p>0)m.participants=[n].concat(m.participants.slice(0,p),m.participants.slice(p+1));};k.prototype.$MercuryThreads19=function(m,n){var o=n.body,p=n.subject,q='';if(p){p=p.toLowerCase();if(o.slice(0,p.length).toLowerCase()==p){q=o;}else if(o){q=p+' \u00B7 '+o;}else q=p;}else q=o;if(n.is_filtered_content)q=c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(n);if(c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(n)){var r=n.author,s=r==this.$MercuryThreads4,t=null;if(!s){t=m.custom_nickname&&m.custom_nickname[c('MercuryIDs').getUserIDFromParticipantID(r)];if(!t){var u=c('MercuryParticipants').getNow(r);if(u!=null)t=u.short_name;}}q=c('MercuryGiftSnippetRenderer').renderText(s,t);}m.snippet=q;m.snippet_has_attachment=n.has_attachment;if(n.raw_attachments&&n.raw_attachments.length>0){var v=c('MercuryAttachment').convertRaw(n.raw_attachments);m.snippet_attachments=v;}else m.snippet_attachments=n.attachments;if(n.log_message_type){m.snippet_sender=null;}else m.snippet_sender=n.author;};k.prototype.$MercuryThreads27=function(m,n){m.page_thread_info=babelHelpers['extends']({},m.page_thread_info,{flagged:n});};k.prototype.$MercuryThreads28=function(m){if(m.folder!==c('MessagingTag').PENDING)return;m.folder=c('MessagingTag').INBOX;};k.prototype.$MercuryThreads15=function(m){return m.filter(function(n){return n!=this.$MercuryThreads4;}.bind(this)).length<=1;};k.prototype.$MercuryThreads13=function(){this.$MercuryThreads5.subscribe('invalidate-thread-state',function(m,n){return this.$MercuryThreads31(n);}.bind(this));this.$MercuryThreads5.subscribe('invalidate-global-state',function(m,n){return this.$MercuryThreads32();}.bind(this));this.$MercuryThreads5.subscribe('update-threads',function(m,n){var o=(n.actions||[]).filter(function(p){return p.thread_id;});if(n.threads&&n.payload_source==c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO)n.threads.forEach(function(p){var q=p.thread_id;if(this.$MercuryThreads9.has(q)){this.$MercuryThreads9['delete'](q);if(p.unread_count)this.$MercuryThreads2.changeThreadReadStatus(p.thread_id,true);}}.bind(this));this.$MercuryThreads33(n.threads);this.$MercuryThreads16(o,n.from_client);n.threads&&n.threads.forEach(function(p){this.$MercuryThreads22(p.thread_id);}.bind(this));if(n.global_actions)n.global_actions.forEach(function(p){if(p.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryThreads30(p.folder);}.bind(this));if(this.$MercuryThreads7){this.$MercuryThreads7=false;i.emit('change');}}.bind(this));};k.prototype.$MercuryThreads33=function(m){if(!m||!m.length)return;var n={},o=[];m.forEach(function(p){var q=new (c('ImmutableObject'))(p);n[p.thread_id]=q;o.push(c('MercuryLoggingHelper').obfuscateThread(q));});o.length&&j.debug('threads_added',JSON.stringify({threads:o}));this.$MercuryThreads8.addResourcesAndExecute(n);};k.prototype.$MercuryThreads22=function(m){this.$MercuryThreads7=true;this.$MercuryThreads3.updatedThread(m);};k.prototype.$MercuryThreads20=function(m){this.$MercuryThreads7=true;this.$MercuryThreads3.deletedThread(m);};k.prototype.$MercuryThreads29=function(m,n,o){this.$MercuryThreads7=true;this.$MercuryThreads3.changedThreadReadState(m,n,o);};k.prototype.$MercuryThreads31=function(m){this.$MercuryThreads8.setResource(m,undefined);};k.prototype.$MercuryThreads32=function(){this.$MercuryThreads7=false;this.$MercuryThreads8=new (c('KeyedCallbackManager'))();this.$MercuryThreads9=new (c('Set'))();this.$MercuryThreads10=false;this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12=new (c('Set'))();};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;},null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryDispatcher','MercuryPayloadSource','MercurySingletonProvider'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryTimestampTracker1=j;this.$MercuryTimestampTracker3=0;this.$MercuryTimestampTracker2=c('MercuryDispatcher').getForFBID(this.$MercuryTimestampTracker1);this.$MercuryTimestampTracker2.subscribe('update-messages',this.$MercuryTimestampTracker4.bind(this));}h.prototype.$MercuryTimestampTracker4=function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source===c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this.$MercuryTimestampTracker3)this.$MercuryTimestampTracker3=m.timestamp;}};h.prototype.getLastUserMessageTimestamp=function(){return this.$MercuryTimestampTracker3;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('ChatTabModel',['Arbiter','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','EventEmitter','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryIDs','MercuryLocalIDs','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker','PresenceState','PresenceUtil','WorkFocusModeController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreads').get(),j=c('MercuryTimestampTracker').get(),k=c('WorkFocusModeController').WorkFocusMode,l=c('InitialServerTime').serverTime,m=c('ChatConfig').get('tab_max_load_age')||3600000,n=20,o=new (c('EventEmitter'))(),p=c('LogHistory').getInstance('chat_tab_model'),q={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function r(na){var oa=c('ChatCookieInterface').load(na,q);oa&&v();return oa;}function s(na,oa,pa){var qa=r(c('PresenceState').get());if(oa===undefined||oa>q.lastChangeTime){if(na()){qa=true;q.lastChangeReason=pa||null;u(oa);}}else p.error('rejected',JSON.stringify({change_time:oa,state_time:q.lastChangeTime}));qa&&t();}function t(){if(q.isInitialized)o.emit('change');}function u(na){if(na===undefined)na=Math.max(j.getLastUserMessageTimestamp()||1,q.lastChangeTime+1);q.lastChangeTime=na;c('PresenceState').doSync();}function v(na){var oa=q.tabs.length-n;if(oa>0)q.tabs=q.tabs.filter(function(pa){return pa.raised||pa.id==na||oa--<=0;});if(oa>0)q.tabs=q.tabs.filter(function(pa){return (pa.id==q.promotedID||pa.id==na||oa--<=0);});}function w(na){for(var oa=0;oa<q.tabs.length;oa++)if(q.tabs[oa].id==na)return oa;return -1;}function x(na,oa){var pa=i.getThreadMetaNow(na);if(!pa)return false;if(pa.is_canonical_user){return aa(na,oa);}else{var qa=z(na);if(qa)h.getServerIDFromClientID(na,function(ra){if(da(na,ra)){u();t();}});return qa;}}function y(na){c('MercuryAssert').isThreadID(na);if(z(na))t();}function z(na){if(w(na)===-1){q.tabs.push({id:na,fragile:true});p.log('open_fragile_tab',JSON.stringify({tabs:JSON.stringify(q.tabs),opened:na,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function aa(na,oa){var pa=w(na);if(pa!=-1)if(q.tabs[pa].fragile){q.tabs.splice(pa,1);}else{oa&&(q.tabs[pa].signatureID=oa);return true;}for(var qa=0;qa<=q.tabs.length;qa++)if(qa==q.tabs.length||q.tabs[qa].fragile){q.tabs.splice(qa,0,{id:na,signatureID:oa});v(na);p.log('open_tab',JSON.stringify({tabs:JSON.stringify(q.tabs),opened:na,window_id:c('PresenceUtil').getSessionID()}));return true;}}function ba(na,oa,pa){c('MercuryAssert').isThreadID(na);var qa=false;if(q.localRaised&&oa){q.localRaised[na]=true;qa=true;}s(function(){if(x(na,pa))qa=true;var ra=w(na);if(ra!=-1&&!q.tabs[ra].raised){q.tabs[ra].raised=true;qa=true;p.log('raise_tab',JSON.stringify({tabs:JSON.stringify(q.tabs),raised:na,window_id:c('PresenceUtil').getSessionID()}));}return qa;});}function ca(na){if(w(na)!==-1&&q.promotedID!==na){q.promotedID=na;return true;}return false;}function da(na,oa){var pa=w(na);if(pa!=-1&&q.tabs[pa].fragile){var qa=q.tabs[pa];qa.fragile=c('MercuryIDs').isLocalThread(na);qa.server_id=oa;var ra=[];q.tabs.forEach(function(sa){if(sa.id!=na){if(qa&&sa.fragile){ra.push(qa);qa=null;}ra.push(sa);}});if(qa)ra.push(qa);q.tabs=ra;p.log('make_permanent',JSON.stringify({tabs:JSON.stringify(q.tabs),tab_id:na,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function ea(na,oa){c('MercuryAssert').isThreadID(na);switch(oa){case 'close_click':case 'close_esc':k&&k.removeBypassFocusModeForThread(na);break;default:break;}var pa=false;if(q.localRaised){delete q.localRaised[na];pa=true;}s(function(){if(fa(na))pa=true;return pa;},undefined,oa);}function fa(na){var oa=w(na);if(na==q.promotedID)q.promotedID=null;if(oa!=-1){q.tabs.splice(oa,1);p.log('close_tab',JSON.stringify({tabs:JSON.stringify(q.tabs),closed:na,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function ga(){if(q.tabs.length){p.log('close_all_tabs',JSON.stringify({closed_tabs:JSON.stringify(q.tabs),window_id:c('PresenceUtil').getSessionID()}));q.tabs=[];q.promotedID=null;if(q.localRaised)q.localRaised={};u();t();}}function ha(){var na=[];for(var oa=0;oa<q.tabs.length;oa++)if(q.tabs[oa].fragile&&!i.isNewEmptyLocalThread(q.tabs[oa].id)){na.push(q.tabs[oa]);q.tabs.splice(oa);t();break;}p.log('close_fragile_tabs',JSON.stringify({tabs:JSON.stringify(q.tabs),fragile_closed:na,window_id:c('PresenceUtil').getSessionID()}));}function ia(na){c('MercuryAssert').isThreadID(na);var oa=false;if(q.localRaised){delete q.localRaised[na];oa=true;}s(function(){var pa=w(na);if(pa!=-1&&q.tabs[pa].raised){delete q.tabs[pa].raised;p.log('lower_tab',JSON.stringify({tabs:JSON.stringify(q.tabs),lowered:na,window_id:c('PresenceUtil').getSessionID()}));oa=true;}return oa;});}function ja(){if(q.localRaised){s(function(){var na=false;q.tabs.forEach(function(oa){if(oa.raised!=q.localRaised[oa.id]){na=true;if(q.localRaised[oa.id]){oa.raised=true;}else delete oa.raised;}});return na;});p.log('persist_local_raise',JSON.stringify({tabs:JSON.stringify(q.tabs),window_id:c('PresenceUtil').getSessionID()}));}}c('PresenceState').registerStateStorer(function(na){return c('ChatCookieInterface').store(na,q);});c('PresenceState').registerStateLoader(function(na){if(r(na))t();});var ka=null,la={getDispatchToken:function(){return ka;},isTabPromoted:function(na){if(na)return na==q.promotedID;return false;},indexOf:function(na){return w(na);},getTab:function(na){c('MercuryAssert').isThreadID(na);var oa=this.indexOf(na);if(oa>-1){var pa=q.tabs[oa];return babelHelpers['extends']({},pa);}return null;},getEmptyTab:function(){var na;for(var oa=0;oa<q.tabs.length;oa++){na=q.tabs[oa].id;if(i.isNewEmptyLocalThread(na))return na;}na=c('MercuryLocalIDs').generateThreadID();i.createNewLocalThread(na,[]);return na;},get:function(){var na=q.tabs.map(function(oa){var pa=babelHelpers['extends']({},oa);delete pa.fragile;if(q.localRaised)pa.raised=q.localRaised[pa.id];return pa;});return {tabs:na,promoted:q.promotedID};},promoteThreadInPlaceOfThread:function(na,oa,pa,qa){c('MercuryAssert').isThreadID(na);c('MercuryAssert').isThreadID(oa);s(function(){var ra=w(na),sa=w(oa);if(qa){q.promotedID=na;}else if(q.promotedID===oa)return true;var ta=q.tabs[ra],ua=q.tabs[sa];delete ua.raised;if(pa){c('MercuryAssert').isThreadID(pa);var va=w(pa);q.tabs[sa]=ta;q.tabs.splice(ra,1);q.tabs.splice(va,0,ua);}else{q.tabs[ra]=q.tabs[sa];q.tabs[sa]=ta;}return true;});},addListener:function(na){return o.addListener('change',na);}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(na,oa){oa.chat_tabs={promoted:q.promotedID,tabs:q.tabs.map(function(pa){return babelHelpers['extends']({},pa);}),time:q.lastChangeTime,max_load_age:m};});function ma(){var na=c('ChatBehavior').ignoresRemoteTabRaise();if(na&&!q.localRaised){p.log('start_ignore_remote_raise','{}');q.localRaised={};t();}else if(!na&&q.localRaised){p.log('stop_ignore_remote_raise','{}');q.localRaised=null;t();}}ka=c('ChatDispatcher').register(function(na){switch(na.actionType){case c('ChatTabActions').Types.CLOSE_TAB:ea(na.threadID,na.reason);break;case c('ChatTabActions').Types.CLOSE_ALL_TABS:ga();break;case c('ChatTabActions').Types.CLOSE_FRAGILE_TABS:ha();break;case c('ChatTabActions').Types.LOWER_TAB:ia(na.threadID);break;case c('ChatTabActions').Types.LOWER_ALL_TABS:for(var oa=q.tabs,pa=Array.isArray(oa),qa=0,oa=pa?oa:oa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ra;if(pa){if(qa>=oa.length)break;ra=oa[qa++];}else{qa=oa.next();if(qa.done)break;ra=qa.value;}var sa=ra;ia(sa.id);}break;case c('ChatTabActions').Types.OPEN_FRAGILE_TAB:y(na.threadID);break;case c('ChatTabActions').Types.OPEN_TAB:c('MercuryAssert').isThreadID(na.threadID);s(function(){return x(na.threadID);});break;case c('ChatTabActions').Types.PERSIST_LOCAL_STATE:ja();break;case c('ChatTabActions').Types.PROMOTE_TAB:c('MercuryAssert').isThreadID(na.threadID);s(ca.bind(null,na.threadID));break;case c('ChatTabActions').Types.RAISE_TAB:ba(na.threadID,na.userAction,na.signatureID);break;}});c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,ma);ma();r(c('PresenceState').getInitial(),true);if(q.lastChangeTime===0)q.lastChangeTime=l-600000;q.isInitialized=true;f.exports=la;},null);
__d('MercuryUnreadState',['invariant','MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=(c('MercuryFolders').getSupportedFolders()||[]).filter(function(p){return p!==c('MessagingTag').ACTION_ARCHIVED;}),j='unread_thread_hash',k='unseen_thread_list',l=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT,m=c('LogHistory').getInstance('mercury_unread_state');n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercuryUnreadState1=p;this.$MercuryUnreadState2=c('MercuryServerRequests').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState3=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState4=c('MercuryThreadInformer').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState5=c('MercuryThreads').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState6=c('MercuryDispatcher').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState7={};this.$MercuryUnreadState8={};this.$MercuryUnreadState9={};this.$MercuryUnreadState10={};this.$MercuryUnreadState11={};i.forEach(function(q){this.$MercuryUnreadState9[q]=0;this.$MercuryUnreadState10[q]=false;this.$MercuryUnreadState11[q]=new (c('KeyedCallbackManager'))();}.bind(this));this.$MercuryUnreadState6.subscribe('update-unread',this.$MercuryUnreadState12.bind(this));this.$MercuryUnreadState6.subscribe('update-thread-ids',function(q,r){this.$MercuryUnreadState13(r);}.bind(this));}n.prototype.getUnreadCount=function(p){if(this.exceedsMaxCount(p)){m.error('unguarded_unread_count_fetch','{}');return 0;}return this.$MercuryUnreadState14(p);};n.prototype.exceedsMaxCount=function(p){return this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>l;};n.prototype.markFolderAsRead=function(p){if(this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>0)this.$MercuryUnreadState2.markFolderAsRead(p);};n.prototype.getIsThreadUnread=function(p,q){var r=q||c('MessagingTag').INBOX,s=this.$MercuryUnreadState15(r);return !!(s&&s[p]);};n.prototype.$MercuryUnreadState12=function(p,q){this.$MercuryUnreadState16(q);var r=q.global_actions||[];for(var s=0;s<r.length;s++){var t=r[s];if(t.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryUnreadState17(t.folder,t.timestamp);}};n.prototype.$MercuryUnreadState18=function(p,q){this.$MercuryUnreadState11[p].setResource(j,q);this.$MercuryUnreadState11[p].setResource(k,Object.keys(q));};n.prototype.$MercuryUnreadState19=function(p,q){var r=this.$MercuryUnreadState11[p].executeOrEnqueue(j,q),s=this.$MercuryUnreadState11[p].getUnavailableResources(r);if(s.length)this.$MercuryUnreadState2.fetchUnreadThreadIDs(p);};n.prototype.$MercuryUnreadState15=function(p){return this.$MercuryUnreadState11[p].getResource(j);};n.prototype.$MercuryUnreadState14=function(p){var q=this.$MercuryUnreadState11[p].getResource(k);if(q){return q.length;}else return this.$MercuryUnreadState9[p];};n.prototype.$MercuryUnreadState16=function(p){var q=void 0;(p.unread_thread_fbids||[]).forEach(function(r){q=r.folder;if(!this.$MercuryUnreadState20(q))return;var s=r.thread_fbids||[];s=s.concat(r.other_user_fbids||[]);var t=this.$MercuryUnreadState21(s);this.$MercuryUnreadState18(q,c('createObjectFrom')(t,true));if(t.length>l)this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState4.updatedUnreadState();}.bind(this));(p.message_counts||[]).forEach(function(r){if(r.unread_count===undefined)return;q=r.folder;if(r.unread_count>l){this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}else{this.$MercuryUnreadState9[q]=r.unread_count;if(this.$MercuryUnreadState9[q]===0)this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));(p.actions||[]).forEach(function(r){if(r.is_forward)return;var s=c('MercuryActionType'),t=r.other_user_fbid?r.other_user_fbid:r.thread_fbid,u=r.thread_id?r.thread_id:t;if(r.action_type==s.DELETE_THREAD){i.forEach(function(w){this.$MercuryUnreadState22(w,u);}.bind(this));}else if(r.action_type==s.CHANGE_ARCHIVED_STATUS||r.action_type==s.CHANGE_FOLDER){var v=this.$MercuryUnreadState5.getThreadMetaNow(r.thread_id);!!!v?h(0):void 0;q=c('MercuryFolders').getFromMeta(v);if(this.$MercuryUnreadState20(q)&&v.unread_count>0)this.$MercuryUnreadState23(q,u);i.forEach(function(w){if(w!=q)this.$MercuryUnreadState22(w,u);}.bind(this));}else{q=this.$MercuryUnreadState24(r);if(!this.$MercuryUnreadState20(q))return;if(r.action_type==s.CHANGE_READ_STATUS){if(r.mark_as_read){this.$MercuryUnreadState22(q,u,r.timestamp);}else this.$MercuryUnreadState23(q,u,r.timestamp);}else if(r.action_type==s.USER_GENERATED_MESSAGE||r.action_type==s.LOG_MESSAGE)if(r.is_unread)this.$MercuryUnreadState23(q,u,r.timestamp);}}.bind(this));};n.prototype.$MercuryUnreadState23=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){var t=this.$MercuryUnreadState7[p]||0,u=this.$MercuryUnreadState8[q]||0,v=r||Number.POSITIVE_INFINITY;if(v>=t&&v>=u&&!s[q]){s[q]=r||0;this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState22=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){if(r){var t=this.$MercuryUnreadState8[q];if(!t||t<r)this.$MercuryUnreadState8[q]=r;}var u=s[q];if(r&&typeof u=='number'&&r<u)return;if(q in s){delete s[q];this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState17=function(p,q){this.$MercuryUnreadState10[p]=false;this.$MercuryUnreadState18(p,{});this.$MercuryUnreadState7[p]=Math.max(this.$MercuryUnreadState7[p]||0,q||0);this.$MercuryUnreadState4.updatedUnreadState();};n.prototype.$MercuryUnreadState21=function(p){return p.map(this.$MercuryUnreadState3.convertThreadIDIfAvailable,this.$MercuryUnreadState3);};n.prototype.$MercuryUnreadState13=function(p){i.forEach(function(q){var r=this.$MercuryUnreadState15(q);if(!r)return;for(var s in p){var t=p[s];if(r[s]){r[t]=r[s];delete r[s];}}this.$MercuryUnreadState18(q,r);}.bind(this));};n.prototype.$MercuryUnreadState24=function(p){var q=p.thread_id?this.$MercuryUnreadState5.getThreadMetaNow(p.thread_id):null;return q?c('MercuryFolders').getFromMeta(q):p.folder?p.folder:'';};n.prototype.$MercuryUnreadState20=function(p){return c('arrayContains')(i,p);};var o=new (c('MercurySingletonProvider'))(n);f.exports=n;},null);
__d('MercuryLeftNav',['Arbiter','MercuryConfig','MercuryThreadInformer','MercuryUnreadState','MessagingTag','NavigationMessage'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadInformer').get(),i=c('MercuryUnreadState').get(),j=false;function k(){var m=i.getUnreadCount(c('MessagingTag').INBOX);c('Arbiter').inform(c('NavigationMessage').NAVIGATION_COUNT_UPDATE,{key:'inbox',count:m});}var l={bootstrap:function(){if(j)return;if(!c('MercuryConfig').ChatLeftNavNoUnreadCountGK)h.subscribe('unread-updated',k);j=true;}};f.exports=l;},null);
__d('MessengerDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('Dispatcher_DEPRECATED'))();},null);
__d('MessengerSpinner.react',['cx','fbt','ix','Image.react','React','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes,n=j('/images/mercury/clients/messenger/core/LoadingSpinner.png'),o=j('/images/mercury/clients/messenger/core/LoadingSpinnerGrey.png'),p=j('/images/mercury/clients/messenger/core/LoadingSpinnerExtraLarge.png'),q=24,r=32;k=babelHelpers.inherits(s,c('React').PureComponent);l=k&&k.prototype;function s(){var t,u;for(var v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];return t=(u=l.constructor).call.apply(u,[this].concat(w)),this.$MessengerSpinner1=function(){return this.props.size===q?this.props.color==='blue'?n:o:p;}.bind(this),t;}s.prototype.render=function(){return c('React').createElement(c('Image.react'),{'aria-label':i._("Loading..."),'aria-busy':true,className:c('joinClasses')(this.props.className,"_3u55 _3qh2"),height:this.props.size,src:this.$MessengerSpinner1(),width:this.props.size});};s.propTypes={color:m.oneOf(['blue','grey']),size:m.oneOf([q,r])};s.defaultProps={color:'blue',size:q};s.Sizes={LARGE:r,MEDIUM:q};f.exports=s;},null);
__d('FBRTCLogger',['Log','LogHistory','MarauderLogger','formatDate','pageID'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='webrtc',i='sent_message',j='received_message',k='send_succeeded',l='send_failed',m='info',n='call_action',o='client_event',p='client_error',q='type',r='msg_id',s='ack_msg_id',t='call_id',u='from',v='to',w='content',x='tag',y='peer_id',z='error_code',aa='trigger',ba='endcallstats',ca=null;da.getInstance=function(){'use strict';if(!ca)ca=new da();return ca;};function da(){'use strict';this.$FBRTCLogger1=c('LogHistory').getInstance(h);}da.prototype.logToConsole=function(ea){'use strict';var fa='Console';this.$FBRTCLogger2(null,null,fa,ea);this.$FBRTCLogger1.log(fa,ea);};da.prototype.logReceivedMessage=function(ea,fa,ga){'use strict';var ha={};ha[u]=ea;ha[t]=fa;ha[q]=ga.type;ha[r]=ga.msg_id;if(ga.sdp)ha[w]=ga.sdp;if(ga.ack_id)ha[s]=ga.ack_id;this.$FBRTCLogger3(j,ha);this.$FBRTCLogger2(ea,fa,'Received',ga.type+', '+ga.msg_id);};da.prototype.logSentMessage=function(ea,fa,ga){'use strict';var ha={};ha[v]=ea;ha[t]=fa;ha[q]=ga.type;ha[r]=ga.msg_id;if(ga.sdp)ha[w]=ga.sdp;if(ga.ack_id)ha[s]=ga.ack_id;this.$FBRTCLogger3(i,ha);this.$FBRTCLogger2(ea,fa,'Sent',ga.type+', '+ga.msg_id);};da.prototype.logSentMessageSuccess=function(ea,fa,ga,ha){'use strict';var ia={};ia[y]=ea;ia[t]=fa;ia[q]=ga;ia[r]=ha;this.$FBRTCLogger3(k,ia);};da.prototype.logSentMessageFailure=function(ea,fa,ga,ha,ia){'use strict';var ja={};ja[y]=ea;ja[t]=fa;ja[q]=ga;ja[r]=ha;ja[z]=ia;this.$FBRTCLogger3(l,ja);this.$FBRTCLogger2(ea,fa,'Send Failed',ga+', '+ia);};da.prototype.logCallAction=function(ea,fa,ga,ha,ia){'use strict';var ja={};ja[y]=ea;ja[t]=fa;ja[n]=ga;ja[w]=ha;if(ia)ja[aa]=ia;this.$FBRTCLogger3(n,ja);this.$FBRTCLogger2(ea,fa,'CallAction',ga+', '+ha);};da.prototype.logEvent=function(ea,fa,event){'use strict';var ga={};ga[y]=ea;ga[t]=fa;ga[w]=event;this.$FBRTCLogger3(o,ga);this.$FBRTCLogger2(ea,fa,'Event',event);};da.prototype.logInfo=function(ea,fa,ga){'use strict';var ha={};ha[y]=ea;ha[t]=fa;ha[w]=ga;this.$FBRTCLogger3(m,ha);this.$FBRTCLogger2(ea,fa,'Info',ga);};da.prototype.logError=function(ea,fa,ga){'use strict';var ha={};ha[y]=ea;ha[t]=fa;ha[w]=ga;this.$FBRTCLogger3(p,ha);this.$FBRTCLogger2(ea,fa,'Error',ga);};da.prototype.logErrorWithoutID=function(ea){'use strict';this.logError(null,null,ea);};da.prototype.logEndCallSummary=function(ea){'use strict';if(!ea)return;var fa={};fa[y]=ea.peerID;fa[t]=ea.callID;fa[x]=ba;fa[w]=ea.toString();var ga=ea.getExtraInfo();for(var ha in ga)if(ga.hasOwnProperty(ha))fa[ha]=ga[ha];this.$FBRTCLogger3(m,fa);this.$FBRTCLogger2(ea.peerID,ea.callID,'Call Summary',fa);};da.prototype.$FBRTCLogger3=function(ea,fa){'use strict';fa.page_id=c('pageID');this.$FBRTCLogger1.log(ea,fa);c('MarauderLogger').log(ea,h,fa);};da.prototype.$FBRTCLogger2=function(ea,fa,ga,ha){'use strict';};da.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};da.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown',RESET_CALL:'install_screen_sharing_ext_dialog'};da.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};f.exports=da;},null);
__d('FBRTCLocalMessageQueue',['CacheStorage','FBRTCLogger','Map','RTCConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='localstorage',i='RTC_',j='offer',k='offer_msg',l='data_',m=30*1000,n=15*1000,o=500,p=new (c('Map'))();function q(){'use strict';this.$FBRTCLocalMessageQueue1=c('FBRTCLogger').getInstance();}q.prototype.enqueueOffer=function(r,s){'use strict';var t=this.$FBRTCLocalMessageQueue2(r,k);this.$FBRTCLocalMessageQueue3(t,j,s);};q.prototype.getOffer=function(r){'use strict';var s=this.$FBRTCLocalMessageQueue2(r,k);return this.$FBRTCLocalMessageQueue4(s,j);};q.prototype.removeOffer=function(r){'use strict';var s=this.$FBRTCLocalMessageQueue2(r,k);s.remove(j);};q.prototype.enqueueMessage=function(r,s,t,u){'use strict';var v=l+t.toString(),w=p.get(r)||new (c('Map'))();w.set(v,u);p.set(r,w);this.$FBRTCLocalMessageQueue1.logToConsole('Queued '+v);};q.prototype.drainQueue=function(r,s){'use strict';var t=p.get(r)||new (c('Map'))(),u,v;for(var w=t,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){if(x){if(y>=w.length)break;var z=w[y++];u=z[0];v=z[1];}else{y=w.next();if(y.done)break;var aa=y.value;u=aa[0];v=aa[1];}void u;s(v);}p.set(r,new (c('Map'))());};q.prototype.enableDequeuing=function(r,s,t,u){'use strict';if(u===undefined)u=n;this.$FBRTCLocalMessageQueue5(r,s,t,u);};q.prototype.$FBRTCLocalMessageQueue5=function(r,s,t,u){'use strict';var v=this.$FBRTCLocalMessageQueue2(r,s),w=v.keys(),x=w.length;for(var y=0;y<x;y++){var z=this.$FBRTCLocalMessageQueue6(v,w[y]);if(z&&t)t(z);}this.$FBRTCLocalMessageQueue1.logToConsole('Dequeued '+x+' ('+r+') with '+u+' left)');if(u>0){u-=o;setTimeout(function(){this.$FBRTCLocalMessageQueue5(r,s,t,u);}.bind(this),o);}};q.prototype.$FBRTCLocalMessageQueue3=function(r,s,t){'use strict';var u={__t:Date.now(),__d:t};r.set(s,u);};q.prototype.$FBRTCLocalMessageQueue4=function(r,s){'use strict';var t=r.get(s);if(t&&this.$FBRTCLocalMessageQueue7(t)){return t.__d;}else if(t)r.remove(s);return null;};q.prototype.$FBRTCLocalMessageQueue6=function(r,s){'use strict';var t=this.$FBRTCLocalMessageQueue4(r,s);if(t!==null){r.remove(s);return t;}return null;};q.prototype.$FBRTCLocalMessageQueue7=function(r){'use strict';return Date.now()-r.__t<m;};q.prototype.$FBRTCLocalMessageQueue2=function(r,s){'use strict';return new (c('CacheStorage'))(h,''+i+r+'_'+s+'_');};f.exports=q;},null);
__d('FBRTCCallControlActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({ACCEPT_ESCALATION:null,HANG_UP:null,PARENT_WINDOW_START_CALL:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,TOGGLE_SELF_VIEW:null,SHOW_SETTINGS:null,START_CALL:null,DECLINE_ESCALATION:null,RECEIVED_SIGNALING_MESSAGE:null,RESET_CALL:null,OPEN_SCREEN_IN_NEW:null,CLOSE_STANDALONE_SCREEN:null,REDIAL_CALL:null}),i={Types:h,hangUp:function(){c('FBRTCDispatcher').dispatch({type:h.HANG_UP});},toggleMuteAudio:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_FULL_SCREEN});},toggleSelfView:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_SELF_VIEW});},showSettings:function(){c('FBRTCDispatcher').dispatch({type:h.SHOW_SETTINGS});},toggleScreenSharing:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_SCREEN_SHARING});},startCall:function(){c('FBRTCDispatcher').dispatch({type:h.START_CALL});},openScreenInNewWindow:function(){c('FBRTCDispatcher').dispatch({type:h.OPEN_SCREEN_IN_NEW});},receivedSignalingMessage:function(j){c('FBRTCDispatcher').dispatch({type:h.RECEIVED_SIGNALING_MESSAGE,message_type:j.msgType,message:j});},acceptEscalation:function(){c('FBRTCDispatcher').dispatch({type:h.ACCEPT_ESCALATION});},declineEscalation:function(){c('FBRTCDispatcher').dispatch({type:h.DECLINE_ESCALATION});},resetCall:function(j){c('FBRTCDispatcher').dispatch({type:h.RESET_CALL,trigger:j});},redialCall:function(){c('FBRTCDispatcher').dispatch({type:h.REDIAL_CALL});},parentWindowStartCall:function(){c('FBRTCDispatcher').dispatch({type:h.PARENT_WINDOW_START_CALL});}};f.exports=i;},null);
__d('FBRTCMessageListener',['invariant','Arbiter','ChannelConstants','FBRTCCallControlActions','FBRTCLocalMessageQueue','FBRTCSupport','RTCConfig','guid','mixInEventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=45*1000,j='rtc_child_window_ready',k='rtc_child_window_start_call',l='rtc_child_window_message',m=[],n=null,o=null,p=null,q=null,r=null,s=false,t=null,u={init:function(v,w){if(s)return;s=true;c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('webrtc'),function(y,z){this._onMessage(z.obj);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('webrtc_offer'),function(y,z){this._onMessage(z.obj);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('webrtc_offerack'),function(y,z){this._onMessage(z.obj);}.bind(this));if(c('RTCConfig').RtcConferencingGK)c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('rtc_multi_json'),function(y,z){this._onMultiwayMessage(z.obj);}.bind(this));this._localMessageQueue=new (c('FBRTCLocalMessageQueue'))();if(c('RTCConfig').PassMessagesBetweenWindowsGK){if(c('FBRTCSupport').isWebrtcSupported()&&window.addEventListener){var x=v?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener('message',x,false);}if(v)this._connectToParentWindow(w);}},setParentWindowNonce:function(v){q=v;},generateNewNonce:function(){r=c('guid')();return r;},setMultiwayMessageHandler:function(v,w){!!t?h(0):void 0;t=w?v.bind(w):v;},_onMultiwayMessage:function(v){this.emit('multiwayMessageReceived',v);if(t)t(v);},setMessageHandler:function(v,w){!!n?h(0):void 0;n=w?v.bind(w):v;while(m.length)n(m.shift());},removeMessageHandler:function(){n=null;},_onMessage:function(v){this.emit('messageReceived',v);if(n){n(v);}else m.push(v);this._passMessageToChildWindow(v);},_connectToParentWindow:function(v){if(window.opener&&window.opener.postMessage){var w={type:j,nonce:q,childNonce:this.generateNewNonce(),peerID:v};window.opener.postMessage(w,window.location.origin);}},_verifyWindowMessage:function(event){return event.origin===window.location.origin&&event.data&&r&&event.data.nonce===r;},_handleWindowMessageToParent:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===j){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);this._replayQueuedMessagesToChild(event.data.peerID,o);}},_handleWindowMessageToChild:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===l)this._onMessage(event.data.message);if(event.data.type===k)c('FBRTCCallControlActions').parentWindowStartCall();},_replayQueuedMessagesToChild:function(v,w){this._localMessageQueue.drainQueue(v,function(x){var y={type:l,nonce:q,message:x};w.postMessage(y,window.location.origin);});},_setChildWindow:function(v){o=v;clearTimeout(p);p=setTimeout(function(){o=null;},i);this._startCallInChildWindow();this.generateNewNonce();},_passMessageToChildWindow:function(v){if(o){var w={type:l,nonce:q,message:v};o.postMessage(w,window.location.origin);}},_startCallInChildWindow:function(){if(o){var v={type:k,nonce:q};o.postMessage(v,window.location.origin);}}};c('mixInEventEmitter')(u,{messageReceived:true,multiwayMessageReceived:true});f.exports=u;},null);
__d('FBRTCMessageHandler',['invariant','Bootloader','FBRTCMessageListener','FBRTCSupport'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=null,j=false,k=null,l={init:function(){if(!j&&c('FBRTCSupport').isReceiveWebrtcSupported()){j=true;c('FBRTCMessageListener').init(false);c('FBRTCMessageListener').once('messageReceived',function(o){m();});c('FBRTCMessageListener').once('multiwayMessageReceived',function(o){n(o);});}},resetListener:function(){!i?h(0):void 0;c('FBRTCMessageListener').removeMessageHandler();c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);}};function m(){if(!i)c('Bootloader').loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(o,p,q,r){i=new o(p,r,new q());c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);},'FBRTCMessageHandler');}function n(o){if(!k)c('Bootloader').loadModules(["FBRTCGroupCallIncomingController"],function(p){k=new p();c('FBRTCMessageListener').setMultiwayMessageHandler(k.onMessageReceived,k);k.onMessageReceived(o);},'FBRTCMessageHandler');}f.exports=l;},null);
__d('SoundPlayer',['URI','createArrayFromMixed'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null,i={};function j(p){var q=new (c('URI'))(p);if(!q.getDomain())return new (c('URI'))(window.location.href).setPath(q.getPath()).toString();return p;}function k(p){var q=new (c('URI'))(p).getPath();if(/\.mp3$/.test(q))return 'audio/mpeg';if(/\.og[ga]$/.test(q))return 'audio/ogg';return '';}function l(){if(!h){var p=document.createElement('audio');if(!p||!p.canPlayType)return null;p.setAttribute('preload','auto');document.body.appendChild(p);h=p;}return h;}function m(p){return i[p];}function n(p,q){i[p]=q;}var o={init:function(p){},createAndPlayNewNative:function(p,q){var r=document.createElement('audio');r.setAttribute('preload','auto');document.body.appendChild(r);r.src=j(p);if(q){r.setAttribute('loop','');}else r.removeAttribute('loop');r.play();n(p,r);return;},play:function(p,q){p=c('createArrayFromMixed')(p);var r=l();for(var s=0;r&&s<p.length;++s){var t=p[s],u=m(t);if(u){if(q){u.setAttribute('loop','');}else u.removeAttribute('loop');u.play();return;}var v=k(t);if(!r.canPlayType(v))continue;o.createAndPlayNewNative(t,q);return;}},stop:function(p){p=c('createArrayFromMixed')(p);for(var q=0;q<p.length;++q){var r=j(p[q]),s=m(p[q]);if(s&&s.src==r){s.pause();s.removeAttribute('src');s.src=r;}}}};f.exports=o;},null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='fb_sounds_playing3';function i(){var m=c('WebStorage').getLocalStorage();if(m)try{var o=m[h];if(o){o=JSON.parse(o);if(Array.isArray(o))return o;}}catch(n){}return [];}function j(m){var n=c('WebStorage').getLocalStorage();if(n){var o=i();o.push(m);while(o.length>5)o.shift();try{n[h]=JSON.stringify(o);}catch(p){}}}function k(m){return i().some(function(n){return n===m;});}var l={play:function(m,n,o){m=c('createArrayFromMixed')(m);n=n||m[0]+Math.floor(Date.now()/1000);if(k(n))return;c('SoundPlayer').play(m,o);j(n);},isSupported:function(){return !!c('WebStorage').getLocalStorage();}};f.exports=l;},null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j,k,l){c('SoundSynchronizer').play(j,k,l);}var i={playLocal:h,playRemote:function(j,k,l,m){var n={name:'SoundRPC',data:{paths:k,sync:l,loop:m}};j.postMessage(c('FBJSON').stringify(n),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){c('Event').listen(window,'message',function(j){if(!/\.facebook.com$/.test(j.origin))return;var k={};try{k=c('FBJSON').parse(j.data);}catch(l){}if(k.name==='SoundRPC')h(k.data.paths,k.data.sync,k.data.loop);});}};f.exports=i;},null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null,i=false,j={init:function(n){},play:function(n,o,p){if(h){c('SoundRPC').playRemote(h.contentWindow,n,o,false);}else c('SoundRPC').playLocal(n,o,p);i=true;},hasPlayedSoundBefore:function(){return i;},playOnlyIfImmediate:function(n,o,p){if(!i&&c('Visibility').isHidden())return;this.play(n,o,p);},stop:function(n){if(!h)c('SoundPlayer').stop(n);}},k=new (c('URI'))(location.href);if(k.getSubdomain()&&k.getSubdomain()!=='www')k.setSubdomain('www');var l=k.getDomain();function m(){if(c('UserAgent_DEPRECATED').ie()<9)return false;if(c('SoundInitialData').RPC_DISABLED)return false;return c('SoundSynchronizer').isSupported()&&c('SoundRPC').supportsRPC();}if(c('isFacebookURI')(k)&&location.host!==l&&m()){h=document.createElement('iframe');h.setAttribute('src','//'+l+'/sound_iframe.php');h.style.display='none';document.body.appendChild(h);}f.exports=j;},null);